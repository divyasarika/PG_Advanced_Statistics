var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Word=function(t){var i={};function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(n,o,function(i){return t[i]}.bind(null,o));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=22)}({22:function(t,i,e){"use strict";e.r(i);var n,o,r,s=function(){function t(){}return t.prototype.u=function(){},t.prototype.shipAssertTag=function(){},t.prototype.debugAssertTag=function(){},t}();(o=n||(n={}))[o.Error=10]="Error",o[o.Warning=15]="Warning",o[o.Info=50]="Info",o[o.Verbose=100]="Verbose",o[o.Spam=200]="Spam",function(t){t[t.h=0]="msoulscat_ES_EWAJS",t[t.v=1]="msoulscat_ES_EWAJSGrid",t[t.g=6]="msoulscat_ES_EWAJSChart",t[t._=202]="msoulscat_MSOSP_FileMenuCommands",t[t.O=301]="msoulscat_Wac_WordViewer",t[t.A=306]="msoulscat_Wac_BrowserGeneral",t[t.U=320]="msoulscat_Wac_TaskPane",t[t.P=339]="msoulscat_Wac_OneNoteGeneral",t[t.R=340]="msoulscat_Wac_Ribbon",t[t.F=379]="msoulscat_Wac_WopiPendingApplication",t[t.W=383]="msoulscat_Wac_Telemetry",t[t.N=391]="msoulscat_Wac_WacCatchUpActivities",t[t.k=394]="msoulscat_Wac_Dictation",t[t.B=395]="msoulscat_Wac_OneNoteSync",t[t.H=700]="msoulscat_Wac_VisioApp",t[t.j=1601]="msoulscat_OneNoteOnline_EditableCache",t[t.J=800]="msoulscat_Wac_PptAnimation",t[t.q=833]="msoulscat_Wac_PptLive",t[t.Z=834]="msoulscat_Wac_PptMWeb",t[t.$=815]="msoulscat_Wac_PptShape",t[t.X=817]="msoulscat_Wac_PptSession",t[t.K=830]="msoulscat_Wac_PptSlideshow",t[t.Y=2300]="msoulscat_Wac_VersionHistory",t[t.tt=302]="msoulscat_Wac_WordPresence",t[t.it=3005]="msoulscat_Wac_WordVersionHistory",t[t.et=3006]="msoulscat_Wac_LivePersonaCard",t[t.nt=3012]="msoulscat_Wac_CatchUpFlyout"}(r||(r={}));var a;(function(){function t(){}t.tagIntToString=function(i){return i<=t.maxNumericTag?i.toString():i>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,255&i):t.map.charAt(i>>24&63)+t.map.charAt(i>>18&63)+t.map.charAt(i>>12&63)+t.map.charAt(i>>6&63)+t.map.charAt(63&i)},t.getLogMessage=function(i,e,n){return"tag_"+t.tagIntToString(i)+" ["+r[e]+"] "+n},t.prototype.u=function(i,e,o,r){var s=console.log;switch(o){case n.Error:s=console.error;break;case n.Warning:s=console.warn;break;case n.Info:s=console.info;break;case n.Verbose:s=console.debug;break;case n.Spam:default:s=console.log}try{s(t.getLogMessage(i,e,r))}catch(t){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw t}},t.prototype.shipAssertTag=function(i,e,n,o){console.assert(n,t.getLogMessage(i,e,o))},t.prototype.debugAssertTag=function(t,i,e,n){this.shipAssertTag(t,i,e,n)},t.maxNumericTag=65535,t.minOldSchemeHighByteValue=36,t.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function t(){this.externalLogger=new s}return t.prototype.setLogger=function(t){this.externalLogger=t},t.prototype.u=function(t,i,e,n){this.externalLogger.u(t,i,e,n)},t.prototype.debugAssertTag=function(t,i,e,n){this.externalLogger.debugAssertTag(t,i,e,n)},t.prototype.shipAssertTag=function(t,i,e,n){this.externalLogger.shipAssertTag(t,i,e,n)},t}());function c(t,i,e){if(""!==i)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(i,t);else{var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",i,e),n.send(t))}}function u(t,i,e,n){var o=t.map((function(t){return function(t,i){var e={};e.G=t.tag,e.T=t.timestamp-i,e.M=t.message,e.C=t.category;var n=1e3*t.type+t.level;return e.D=n,e}(t,n)})),r=function(t,i,e,n){var o={};return o.T=t,o.L=i,o.S=e,o.I=n,o.V=1,o}(n,o,i,e);return JSON.stringify(r)}!function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(a||(a={}));!function(){function t(i,e){var n=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){n.triggerUpload(!1,!1)},this.flush=function(){n.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return n.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(i,e){(window.clearTimeout(n.timeoutId),n.logCache.length>0)&&(n.uploadId+=1,c(u(n.logCache,n.userSessionId,n.uploadId,n.timestampBase),n.remoteUrlEndpoint,e),n.logCache=[],n.timestampBase=Date.now());i&&(n.timeoutId=window.setTimeout(n.triggerUploadAsync,t.uploadCadenceInMsSec))},this.userSessionId=i,this.remoteUrlEndpoint=e+"?usid="+i,window.setTimeout((function(){return n.triggerUpload(!0,!0)}),0)}t.prototype.handleTrace=function(i){i.message.length>t.messageMaxChars&&(i.message=i.message.substr(0,t.messageMaxChars-t.trimmedMessage.length)+t.trimmedMessage),this.logCache.push(i),(this.logCache.length>t.uploadTriggerSize||i.level===n.Error)&&this.triggerUploadAsync()},t.messageMaxChars=3072,t.uploadCadenceInMsSec=3e4,t.uploadTriggerSize=30,t.trimmedMessage="... [Trimmed]"}();n.Info;var h=function(t,i){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function f(t,i){function e(){this.constructor=t}h(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}var d=function(){return(d=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)};var l;!function(t){function i(){return null!==t&&t.apply(this,arguments)||this}f(i,t)}(s);function p(){if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;if(t.indexOf("Firefox")>-1)return l.Firefox;if(t.indexOf("Opera")>-1)return l.Opera;if(t.indexOf("Trident")>-1)return l.IE;if(t.indexOf("Edge")>-1)return l.Edge;if(t.indexOf("Chrome")>-1)return l.Chrome;if(t.indexOf("Safari")>-1)return l.Safari}return l.Unknown}function v(){"undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}})}function m(){try{return navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("Macintosh")>=0&&S()&&!(navigator.userAgent.indexOf("iPhone")>=0)||navigator.userAgent.indexOf("Android")>=0||S()}catch(t){return!1}}function w(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(t){return!1}}function g(){return p()===l.IE&&!function(){if(p()!==l.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function I(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(t){return!1}}function S(){return navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}!function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.Unknown=6]="Unknown"}(l||(l={}));function b(t){return 8===t.toLowerCase().indexOf("ffc")}function C(t){return 8===t.toLowerCase().indexOf("ppc")}function y(t){var i=t.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return i&&i[1]?i[1]:"public"}function T(t){var i=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function _(t,i){var e=t.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!e)throw new Error("Invalid URL");var n=e[2];if(void 0===i)return n;if(i<0)throw new Error("subDomainParts should be at least 1");return n.split(".").slice(-(i+1)).join(".")}function O(t){return t+"RemoteUls.ashx"}function A(t,i,e){e&&(t[i.toLowerCase()]=e)}function U(t,i){var e=t.indexOf("&"+i+"=");if(-1===e&&(e=t.indexOf("?"+i+"=")),-1===e)return"";var n=e+(i.length+2),o=t.indexOf("&",n);return t.substring(n,-1===o?void 0:o)}function P(t,i,e,n){if(void 0===n&&(n=!1),!e)return t;var o=t,r=o.indexOf("?"),s="&";r===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?s="":-1===r&&(s="?");var a=i.toLowerCase()+"=",c=o.toLowerCase().indexOf(a,r);if("?"!==s&&c>=0){if(n){var u=o.indexOf("&",c);o=o.substring(0,c)+a+e+(-1===u?"":o.substring(u))}return o}return o.concat(s,a,e)}function E(t){var i={},e=t.indexOf("?");return-1===e||e===t.length-1||t.substring(e+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(t){if(t){var e=t.indexOf("=");-1!==e&&e!==t.length-1&&(i[t.substring(0,e).toLowerCase()]=t.substring(e+1))}})),i}function R(t){if(!t)return"";var i=-1===t.indexOf("#")?t.length:t.indexOf("#"),e=t.lastIndexOf("/",i);if(-1!==e&&e+1===t.indexOf("://")+"://".length)return"";e+=1;var n=t.indexOf("?");if(-1!==(n=n>=i?-1:n)&&e>n)return"";var o=-1===n?i:n;return e>=o?"":t.substring(e,o)}function F(t){var i=new RegExp("(c[1-5])h?(-)");return t.replace(i,"$1h$2")}function W(t){return/[?&]new=1\b/i.test(t)}function N(t,i){return{shouldPreload:function(i){return t(i)},preload:function(t,e,o,s){i(t,e,s).forEach((function(t){!function(t,i,e,o){var s=document.createElement("link");if(s.setAttribute("crossorigin","anonymous"),s.rel=M,s.href=t,i){var a=e||R(t);i.ULS.u(592315601,r.F,n.Info,"Preloading resource: "+a);s.addEventListener("error",(function(){i.ULS.u(592479445,r.F,n.Error,"Resource failed to load: "+a)}))}s.setAttribute("as","script"),document.head.appendChild(s),o&&s.addEventListener("load",o,{once:!0})}(t,o)}))}}}var x,M=(x=p())===l.Firefox||x===l.IE?"prefetch":"preload";var k;!function(t){t.Unknown="UNKNOWN",t.Initialized="INITIALIZED",t.Prebooted="PREBOOTED",t.Booting="BOOTING",t.Booted="BOOTED",t.Failed="FAILED",t.Disposing="DISPOSING",t.Disposed="DISPOSED"}(k||(k={}));var D,B=function(){try{var t=window.performance;return t&&t.now&&t.now()!==1/0}catch(t){return!1}}();function H(){return B?window.performance.now():Date.now()}function j(){if(!D){var t=window.performance;D=B&&t.timing&&t.timing.navigationStart?function(){return Math.round(t.now()+t.timing.navigationStart)}:Date.now?Date.now:function(){return(new Date).getTime()}}return D()}var J,L,V=function(){function t(t){var i=this;this.ot=3e4,this.rt=30,this.st=0,this.at=[],this.ct=j(),this.ut="",this.ht=0,this.flushOnClose=function(){i.ft(!1,!1)},this.flush=function(){i.dt()},this.dt=function(){window.setTimeout((function(){return i.ft(!0,!0)}),0)},this.ft=function(t,e){var n=H();if(window.clearTimeout(i.lt),i.pt){if(i.at.length>0)i.st+=1,c(u(i.at.splice(0,t?i.rt:i.at.length),i.ut,i.st,i.ct),i.pt,e),i.ct=j();t&&(i.lt=window.setTimeout(i.dt,i.at.length>i.rt?1e3:i.ot)),i.ht+=H()-n}},t&&this.configure(t)}return t.prototype.getTimeSpentLogging=function(){return this.ht},t.prototype.addLoggingTime=function(t){this.ht+=t},t.prototype.configure=function(t){var i=this,e=H();if(t.uploadCadenceInMs&&(this.ot=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.rt=t.uploadTriggerSize),t.sessionId&&(this.ut=t.sessionId),t.remoteUlsEndpoint){if(!t.sessionId&&this.pt)throw new Error("Remote ULS endpoint is already set");this.pt=t.remoteUlsEndpoint+"?usid="+this.ut,this.ct=j(),window.setTimeout((function(){return i.ft(!0,!0)}),0)}this.ht+=H()-e},t.prototype.handleTrace=function(t){var i=H();t.message.length>3072&&(t.message=t.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.at.push(t),(this.at.length>this.rt||t.level===n.Error)&&this.dt(),this.ht+=H()-i},t}(),z=[];!function(t){t.vt="ExcelInstantShellEnabled",t.wt="BootstrapperMaxUlsHeartbeatTime",t.gt="BootstrapperNoCompleteWarning1Time",t.It="BootstrapperNoCompleteWarning2Time",t.St="RemoteUlsETag",t.bt="RemoteUlsSuppressions",t.Ct="BootstrapperSettingsFetchPeriod",t.yt="timestamp",t.Tt="BootstrapperUlsHeartbeatIntervalMs",t._t="BootstrapperUlsHeartBeatIsEnabled",t.Ot="BootstrapperUlsUploadCadenceMs"}(L||(L={}));function q(t){var i=new V(t);function e(t,e,n,o){var r=H();if(!function(t){return 1===z[t]}(t)){var s={timestamp:j(),category:e,tag:t,level:n,type:a.Trace,message:o};i.addLoggingTime(H()-r),i.handleTrace(s)}}return{ULS:{u:function(t,i,n,o){e(t,i,n,o)},shipAssertTag:function(t,i,o,r){o&&e(t,i,n.Error,r)},debugAssertTag:function(t,i,e,n){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:i.flush,flushOnClose:i.flushOnClose},configure:function(t){i.configure(t)},settingsChangeHandler:function(t){var e,n;e=t.At.getValue(L.bt,""),n=t.At.getValue(L.St,""),J&&n===J||(z=[],J=n,e&&e.split(",").forEach((function(t){var i=parseInt(t,10);i&&(z[i]=1)}))),i.configure({uploadCadenceInMs:t.At.getValue(L.Ot,6e4)})},getTimeSpentLogging:function(){return i.getTimeSpentLogging()}}}var G= "16.0.13415.41000";function Z(){return G}var $,X,K;function Q(){return function(t){if(!t)throw new Error("Build number not available");var i=t.split(".");if(4!==i.length)throw new Error("Build number has incorrect format");return i[0]+i[2]+i[3]}(Z())}function Y(t){return JSON.stringify(t,Object.getOwnPropertyNames(t))}function tt(t,i){try{if(void 0===window.performance)return void i.ULS.u(595948609,r.F,n.Info,"Performance not supported");var e=window.performance.getEntriesByType("resource");if(void 0===e||e.length<=0)return void i.ULS.u(595948610,r.F,n.Info,"No resources under performance");for(var o=new RegExp(t+"[-.]boot(.min)?.js","i"),s=e.length-1;s>=0;s-=1){var a=e[s],c=a.name.match(o);if(c){var u=JSON.stringify(a);return u=u.replace(new RegExp(a.name,"g"),c[0]),void i.ULS.u(595948616,r.F,n.Info,u)}}i.ULS.u(595948484,r.F,n.Info,"Could not find JSAPI resource timing entry")}catch(t){i.ULS.u(595948617,r.F,n.Info,"Could not trace the resource timing: "+Y(t))}}function it(t){var i=d(d({},t.host),{sessionId:t.hostSessionId,domain:location?location.host:void 0}),e={};if(t.wdParams){var n=JSON.parse(JSON.stringify(t.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(t){n[t]&&(e[t]=n[t])}))}var o=d({},t.rebootOverride);delete o.ackExpected,delete o["ui-language"],delete o.wdUserSession,delete o.rebootMode,delete o.documentUrl;var r=t.wopi;return{accessToken:r?{length:r.accessToken.length,expiry:r.expiry}:"N/A",bootParams:t.bootParams,build:Z(),host:i,intent:t.intent,jsApiVersion:"v2",rebootOverride:o,region:y(t.appBaseUrl),sessionOrigin:t.hostInitDiagnostics?t.hostInitDiagnostics.entryPoint:void 0,sessionContext:t.sessionContext,throttling:t.throttling,ui:t.ui,viewMode:t.viewMode,wdParams:e}}function et(){var t={perfNowSupported:B,browser:l[p()],touchMode:m(),highContrast:w(),windows10x:I()};try{var i=window.navigator,e=i.connection||i.mozConnection||i.webkitConnection;e&&(t.netDownlink=e.downlink,t.netDownlinkMax=e.downlinkMax,t.netEffectiveType=e.effectiveType,t.netRtt=e.rtt,t.netSaveData=e.saveData,t.netType=e.type),t.deviceMemory=i.deviceMemory,t.logicalProcessors=i.hardwareConcurrency}catch(t){}return t}function nt(t,i,e){t.ULS.u(595957843,r.F,n.Info,"Page lifecycle: "+i+" fired"+(e?", flushing logger":"")),e&&t.ULS.flush()}function ot(t,i){$=function(){return nt(t,"OnBeforeUnload",i)},X=function(){return nt(t,"OnPageHide",i)},K=function(){return nt(t,"VisibilityChange_"+document.visibilityState,i)},window.addEventListener("beforeunload",$,{capture:!0,once:!0}),window.addEventListener("pagehide",X,{capture:!0}),window.addEventListener("visibilitychange",K,{capture:!0})}function rt(){window.removeEventListener("beforeunload",$,{capture:!0}),window.removeEventListener("pagehide",X,{capture:!0}),window.removeEventListener("visibilitychange",K,{capture:!0})}var st,at;function ct(t,i,e,o){if(i.getValue(L._t,!1)){st=H();var s=t?3e3:5e3;at=window.setInterval((function(){e.ULS.u(595724178,r.F,n.Info,"Boot_HeartBeat"),H()-st>i.getValue(L.wt,3e5)&&(ut(),o&&o())}),i.getValue(L.Tt,s))}}function ut(){at&&(window.clearInterval(at),at=void 0)}var ht;function ft(t,i){t.ULS.u(594901218,r.F,n.Warning,"Boot_NotComplete_"+(i||"Final")),t.ULS.flush()}function dt(t){for(var i=0;i<t.length;i+=1)t[i]&&window.clearTimeout(t[i])}function lt(t,i){return{isFeatureEnabled:function(e){return function(t,i,e){if(!i)return;try{return i(t)}catch(t){e&&e.ULS.u(594883024,r.F,n.Error,"IsFeatureEnabled callback error: "+Y(t))}return}(e,t,i)}}}function pt(t,i){var e={};if(Object.keys(ht).forEach((function(i){var n=t.isFeatureEnabled(ht[i]);void 0!==n&&(e[ht[i]]=n?"1":"0")})),i&&i.wdFlights)for(var n=0,o=i.wdFlights.toLowerCase().split(",");n<o.length;n++){var r=o[n];"et-treatment"!==r&&"et-control"!==r||(e[ht.Ut]="et-treatment"===r?"1":"0")}return JSON.stringify(e)}!function(t){t.Ut="EnterpriseTemplates",t.Pt="ExcelAdaptiveLayoutDownload",t.Et="ExcelJsApiV2",t.Rt="ExcelJsApiV2NoWrapper",t.Ft="ExcelLandingPageOfflineTelemetry",t.Wt="ExcelLandingPageObserverRetry",t.Nt="H2StaticContent",t.xt="HashedUrl",t.Mt="InstantShell",t.kt="ODCShareLinkPreload",t.Dt="OfficeComExcelJsApiV2",t.Bt="OfficeComUiHost",t.Ht="OfficeComWordJsApiV2",t.jt="OfficeHwaUiHost",t.Jt="WordJsApiV2",t.Lt="WordJsApiV2NoWrapper",t.Vt="WordScriptsPreload"}(ht||(ht={}));var vt,mt,wt,gt,It,St,bt=function(){function t(){this.zt=[]}return t.prototype.add=function(t){t&&this.zt.push(t)},t.prototype.remove=function(t){if(t){var i=this.zt.indexOf(t);i>-1&&this.zt.splice(i,1)}},t.prototype.removeAll=function(){this.zt=[]},t.prototype.dispatch=function(t,i){this.zt.forEach((function(e){try{e(t)}catch(t){i&&i(t)}}))},t}(),Ct=function(){function t(t,i){var e=this;this.qt=0,this.Gt=function(){if(e.Zt){var t=new XMLHttpRequest;t.open("GET",e.Zt),t.responseType="json",t.timeout=5e3,t.send(),t.onload=function(){if(200===t.status&&t.response?(e.setSettingsOnIdle(t.response),e.qt=0):(e.$t.ULS.u(592836771,r.F,n.Error,"Fetch settings error. Status: "+t.status+", curErrors: "+e.qt),e.qt+=1),!(e.qt>7)){var i=e.getValue(L.Ct,3e5);e.qt>3&&(i+=(e.qt-3+1)*(i/2)),e.Xt=window.setTimeout(e.Gt,i)}}}},this.Kt=t,this.Qt="Prod"+t+"Settings",this.$t=i,this.Yt=new bt,this.getCurrentSettings()}return t.prototype.initializePeriodicFetch=function(t,i){this.Qt=(b(t)?"FF":"Prod")+this.Kt+"Settings",this.getCurrentSettings(),this.Zt=t+"AppSettingsHandler.ashx?app="+this.Kt+"&usid="+i+"&build="+Z(),this.Xt||(this.Xt=window.setTimeout(this.Gt,3e4))},t.prototype.getValue=function(t,i){if(this.ti||this.getCurrentSettings(),!this.ti||!this.ti.hasOwnProperty(t))return i;var e=this.ti[t],n=typeof i;if(typeof e===n)return e;if("string"==typeof e){if("number"===n)return parseInt(e,10);if("boolean"===n)return"true"===e}return i},t.prototype.addSettingsChangeListener=function(t){this.Yt.add(t)},t.prototype.removeSettingsChangeListener=function(t){this.Yt.remove(t)},t.prototype.dispose=function(){this.Xt&&window.clearTimeout(this.Xt),this.ii&&self.cancelIdleCallback(this.ii),this.Xt=void 0,this.ii=void 0,this.ti=void 0,this.Yt.removeAll()},t.prototype.getCurrentSettings=function(){try{if(!window||!window.localStorage)return;var t=window.localStorage.getItem(this.Qt);if(!t)return;var i=JSON.parse(t);this.updateCurrentSettings(i)}catch(t){this.$t.ULS.u(592836768,r.F,n.Warning,"Failed to get settings from localStorage: "+Y(t))}},t.prototype.updateCurrentSettings=function(t){var i=this;return!!this.isValidSettings(t)&&(this.ti=t,this.Yt.dispatch({At:this},(function(t){i.$t.ULS.u(592836769,r.F,n.Error,"Settings listener error: "+Y(t))})),!0)},t.prototype.isValidSettings=function(t){if(t&&"object"==typeof t){if(t.hasOwnProperty(L.yt)&&!isNaN(t.timestamp))return!0;this.$t.ULS.u(592836770,r.F,n.Error,"Received invalid settings")}return!1},t.prototype.setSettingsOnIdle=function(t){var i=this;"requestIdleCallback"in window?(this.ii&&self.cancelIdleCallback(this.ii),this.ii=window.requestIdleCallback((function(){return i.setSettings(t)}),{timeout:1e4})):window.setTimeout((function(){return i.setSettings(t)}),0)},t.prototype.setSettings=function(t){if(this.updateCurrentSettings(t)&&window&&window.localStorage){var i=JSON.stringify(t);try{window.localStorage.setItem(this.Qt,i)}catch(t){this.$t.ULS.u(592836800,r.F,n.Warning,"Failed to set localStorage: "+Y(t))}}},t}();!function(t){t.accessToken="accessToken",t.appReboot="appReboot",t.authToken="authToken",t.boot="boot",t.closeTab="closeTab",t.customAuthConfig="customAuthConfig",t.createNew="createNew",t.dispose="dispose",t.fileEmbed="fileEmbed",t.frameTrust="frameTrust",t.handleBootState="handleBootState",t.postMessage="postMessage",t.refreshSessionInfo="refreshSessionInfo",t.rename="rename",t.setOverlayContent="setOverlayContent",t.switchMode="switchMode",t.userAccessAndPermissions="userAccessAndPermissions",t.wopiInfoFromUrl="wopiInfoFromUrl"}(vt||(vt={})),function(t){t.blurFocus="blurFocus",t.boot="boot",t.completeCreateNew="completeCreateNew",t.continueAccessibilityLoop="continueAccessibilityLoop",t.createNew="createNew",t.dispose="dispose",t.grabFocus="grabFocus",t.popState="popState",t.rename="rename",t.sendAccessToken="sendAccessToken",t.sendAuthToken="sendAuthToken",t.sendCustomAuthConfig="sendCustomAuthConfig",t.sendEmbeddedViewUrl="sendEmbeddedViewUrl",t.sendSessionInfo="sendSessionInfo",t.sendUserAccessAndPermissions="sendUserAccessAndPermissions",t.sendWopiInfo="sendWopiInfo",t.switchMode="switchMode"}(mt||(mt={})),function(t){t.ei="App_AccessibilityLoopComplete",t.ni="WacInitialize_Ready",t.oi="Wac_AppFailed",t.ri="Wac_AppBootState",t.si="Wac_AppCompleted",t.ai="BrowserEvent",t.ci="UI_Close",t.hi="App_CloseTab",t.fi="UI_Conversation",t.di="UI_CopyAndEdit",t.li="App_CreateNewDocument",t.pi="Wac_AppDataSavedStatus",t.vi="UI_Download",t.mi="UI_Edit",t.wi="Error",t.gi="UI_FileEmbed",t.Ii="UI_FileProperties",t.Si="File_Rename",t.bi="File_RenameFailed",t.Ci="UI_FileVersions",t.yi="StateChanged",t.Ti="App_IsFrameTrusted",t._i="GetAccessToken",t.Oi="App_GetAuthToken",t.Ai="App_GetCustomAuthConfig",t.Ui="App_WopiInfoFromUrl",t.Pi="App_LoadingStatus",t.Ei="App_SwitchMode",t.Ri="UI_OpenInBrowser",t.Fi="UI_OpenInClient",t.Wi="PageChanged",t.Ni="App_PushCommentContext",t.xi="App_PushState",t.Mi="App_DocReboot",t.ki="UI_RedeemForCommenting",t.Di="App_RefreshSessionInfo",t.Bi="UI_ReplyWithChanges",t.Hi="UI_ReportAbuse",t.ji="UI_SaveStatus",t.Ji="WopiSession_Complete_Ack",t.Li="SetOverlayContent",t.Vi="UI_Sharing",t.zi="UI_ShareForm",t.qi="UI_SignIn",t.Gi="App_Unloaded",t.Zi="Wac_UnloadingApp",t.$i="PageCount",t.Xi="UI_CheckUserAccessAndGrantPermissions",t.Ki="User_Activity",t.Qi="Edit_Notification",t.Yi="UI_Workflow",t.te="ZoomChanged"}(wt||(wt={})),function(t){t.ie="Ack",t.ee="WacInitialize_Ready_Ack",t.ne="Wac_BeforeUnloadApp",t.oe="Blur_Focus",t.re="Wac_AppFailed_Ack",t.se="Wac_AppCompleted_Ack",t.ae="WopiStartSession_Complete",t.ce="WopiPendingSession_Complete",t.ue="Host_AccessibilityLoopComplete",t.Ti="Host_IsFrameTrusted",t.he="Grab_Focus",t.fe="HostCacheDiagnostic",t.de="JsApiDiagnostics",t.le="PageChanged_Ack",t.pe="App_PopState",t.ve="Host_PostmessageReady",t.me="File_Rename",t.we="PostAccessToken",t.ge="Host_SetAuthToken",t.Ie="Host_SetCustomAuthConfig",t.Se="App_PushCommentContext",t.be="CanEmbed",t.Ce="Host_RefreshSessionInfo",t.ye="CheckUserAccessAndGrantPermissions_Result",t.Te="Host_WopiInfoFromUrl",t._e="SetCurrentPage",t.Oe="SetZoomLevel",t.Ae="WopiPendingSession_Fail",t.Ue="SetOverlayContent",t.Pe="WopiPendingApplicationComplete_Received",t.Ee="Host_SwitchMode",t.Re="Host_Unload",t.Fe="PageCount_Ack",t.We="ZoomChanged_Ack"}(gt||(gt={})),function(t){t.AccessibilityLoopCompleted="AccessibilityLoopCompleted",t.BootCompleted="BootCompleted",t.BrowserEvent="BrowserEvent",t.Close="Close",t.Conversation="Conversation",t.CopyAndEdit="CopyAndEdit",t.CreateNewDocument="CreateNewDocument",t.Disposed="Disposed",t.Download="Download",t.Edit="Edit",t.Error="Error",t.FileEmbed="FileEmbed",t.FileProperties="FileProperties",t.FileRenamed="FileRenamed",t.FileVersions="FileVersions",t.FrameStateChanged="FrameStateChanged",t.GetAccessToken="GetAccessToken",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.GetWopiInfoFromUrl="GetWopiInfoFromUrl",t.ModeSwitched="ModeSwitched",t.OpenInBrowser="OpenInBrowser",t.OpenInClient="OpenInClient",t.PageChanged="PageChanged",t.PushState="PushState",t.Reboot="Reboot",t.RedeemForCommenting="RedeemForCommenting",t.RefreshSessionInfo="RefreshSessionInfo",t.ReplyWithChanges="ReplyWithChanges",t.ReportAbuse="ReportAbuse",t.SaveStatus="SaveStatus",t.Share="Share",t.ShareForm="ShareForm",t.SignIn="SignIn",t.UserAccessAndPermissions="UserAccessAndPermissions",t.UserActivity="UserActivity",t.UserEditActivity="UserEditActivity",t.Workflow="Workflow",t.ZoomChanged="ZoomChanged"}(It||(It={}));var yt=((St={})[mt.boot]={Ne:vt.boot},St[mt.createNew]={Ne:vt.createNew},St[mt.dispose]={Ne:vt.dispose},St[mt.rename]={Ne:vt.rename},St[mt.switchMode]={Ne:vt.switchMode},St[wt.ri]={Ne:vt.handleBootState},St[wt.hi]={Ne:vt.closeTab},St[wt.Ti]={Ne:vt.frameTrust},St[wt.gi]={Ne:vt.fileEmbed},St[wt._i]={Ne:vt.accessToken},St[wt.Oi]={Ne:vt.authToken},St[wt.Ai]={Ne:vt.customAuthConfig},St[wt.Ui]={Ne:vt.wopiInfoFromUrl},St[wt.Mi]={Ne:vt.appReboot},St[wt.Di]={Ne:vt.refreshSessionInfo},St[wt.Li]={Ne:vt.setOverlayContent},St[wt.Xi]={Ne:vt.userAccessAndPermissions},St[mt.blurFocus]={xe:gt.oe},St[mt.continueAccessibilityLoop]={xe:gt.ue},St[mt.grabFocus]={xe:gt.he},St[mt.popState]={xe:gt.pe},St[wt.ei]={Me:It.AccessibilityLoopCompleted},St[wt.ai]={Me:It.BrowserEvent},St[wt.ci]={Me:It.Close},St[wt.fi]={Me:It.Conversation},St[wt.di]={Me:It.CopyAndEdit},St[wt.li]={Me:It.CreateNewDocument},St[wt.vi]={Me:It.Download},St[wt.mi]={Me:It.Edit},St[wt.wi]={Me:It.Error},St[wt.Ii]={Me:It.FileProperties},St[wt.Si]={Me:It.FileRenamed},St[wt.Ci]={Me:It.FileVersions},St[wt.yi]={Me:It.FrameStateChanged},St[wt.Ei]={Me:It.ModeSwitched},St[wt.Ri]={Me:It.OpenInBrowser},St[wt.Fi]={Me:It.OpenInClient},St[wt.Wi]={Me:It.PageChanged},St[wt.xi]={Me:It.PushState},St[wt.ki]={Me:It.RedeemForCommenting},St[wt.Bi]={Me:It.ReplyWithChanges},St[wt.Hi]={Me:It.ReportAbuse},St[wt.ji]={Me:It.SaveStatus},St[wt.Vi]={Me:It.Share},St[wt.zi]={Me:It.ShareForm},St[wt.qi]={Me:It.SignIn},St[wt.Ki]={Me:It.UserActivity},St[wt.Qi]={Me:It.UserEditActivity},St[wt.Yi]={Me:It.Workflow},St[wt.te]={Me:It.ZoomChanged},St);function Tt(){var t=new Uint8Array(31),i=function(t){var i={crypto:!1,perfNow:!1,exceptions:[]},e=window.crypto||window.msCrypto;if(e){i.crypto=!0;try{return e.getRandomValues(t),i}catch(t){i.exceptions.push("crypto: "+Y(t))}}i.perfNow=B;for(var n=0;n<t.length;n+=1){try{if(B){var o=Math.floor(100*window.performance.now())%10;(o<0||o>9)&&(o=0);for(var r=0;r<o;r+=1)Math.random()}}catch(t){i.exceptions.push("Math.random: "+Y(t))}t[n]=Math.floor(16*Math.random())}return i}(t),e=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=15&t[e];return e+=1,("x"===i?n:3&n|8).toString(16)})),i]}var _t=function(){function t(t,i,e,o,s,a,c){var u,h=this;this.pendingReboot=!1,this.skipWopiValidation=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.ke={},this.onMessage=function(t){var i=t.MessageId,e=t.Values||{},o=h.ke[i];if(o&&o.length>0)h.dispatchAction(i,e);else{var s=yt[i];if(s){var a=s.Ne,c=s.Me;a?h.De[a](i,e,h,h.Be[a]).catch((function(t){h.logger.ULS.u(593364502,r.F,n.Error,a+" flow error: "+Y(t))})):c&&h.raiseEvent(c,e)}}},this.state=k.Unknown;var f=Tt(),d=f[0],l=f[1];this.logger=q(),this.logger.ULS.u(593506837,r.F,n.Info,JSON.stringify(l)),this.sessionId=d,this.hostSessionId=e.hostSessionId,this.host=t.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=t.user,this.bootstrapperUrl=t.bootstrapperUrl,this.ui=t.ui,this.viewMode=t.viewMode,this.application=o,this.appInfo=i,this.session=s,this.featureManager=lt(t.host.capabilities&&t.host.capabilities.isFeatureEnabledCallback,this.logger),this.At=new Ct(i.name,this.logger),this.preloader=i.preloader,u=a(this.featureManager),this.De=u[0],this.Be=u[1],this.He=c,this.At.addSettingsChangeListener(this.logger.settingsChangeHandler)}return Object.defineProperty(t.prototype,"diagnostics",{get:function(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}},enumerable:!0,configurable:!0}),t.prototype.raiseEvent=function(t,i){try{this.He(t,i)}catch(t){this.logger.ULS.u(593506838,r.F,n.Error,"Event handler error: "+Y(t))}},t.prototype.addActionHandler=function(t,i){this.ke[t]||(this.ke[t]=[]),this.ke[t].push(i)},t.prototype.removeActionHandler=function(t,i){var e=this.ke[t];if(e&&e.length>0){var n=e.indexOf(i);n>-1&&e.splice(n,1)}},t.prototype.run=function(t,i,e){var o=this,s=[],a=this.ke[t];if(a&&a.length>0)s.push(this.dispatchAction(t,i));else{var c=yt[t];if(c){var u=c.Ne,h=c.xe;if(u){var f=(0,this.De[u])(t,i,this,this.Be[u],e).catch((function(t){return o.logger.ULS.u(593364501,r.F,n.Error,u+" flow error: "+Y(t)),{completion:"failure",error:t}}));s.push(f)}else h&&(this.shouldUseContainer()?this.container&&this.container.postMessage(h,i):this.De[vt.postMessage](t,i,this,void 0),s.push(Promise.resolve({completion:"success"})))}else s.push(Promise.resolve({completion:"failure"})),this.logger.ULS.u(593500189,r.F,n.Warning,"Unhandled command: "+t)}return Promise.race(s)},t.prototype.dispose=function(){if(this.At.dispose(),this.ke={},!this.pendingReboot){var t=this.application.sessions,i=t.indexOf(this.session);i&&t.splice(i,1)}},t.prototype.shouldUseContainer=function(){var t=!1;return"Word"===this.appInfo.name?t=this.featureManager.isFeatureEnabled(ht.Lt)||this.featureManager.isFeatureEnabled(ht.Ht):"Excel"===this.appInfo.name&&(t=this.featureManager.isFeatureEnabled(ht.Rt)||this.featureManager.isFeatureEnabled(ht.Dt)),t},t.prototype.dispatchAction=function(t,i){var e=this;return this.ke[t].map((function(o){try{o(t,i)}catch(i){e.logger.ULS.u(593773709,r.F,n.Error,t+" action handler error: "+Y(i))}})),Promise.resolve({completion:"success"})},t}();var Ot,At=function(){function t(t,i,e,n,o,r){var s=this;!function(t){if(void 0===t)throw new TypeError("SessionInitParams");if(void 0===t.hostSessionId)throw new TypeError("HostSessionId")}(e);this.je=new _t(t,i,e,n,this,r,(function(t,i){return o({type:t,data:i,session:s})})),this.je.state=k.Initialized}return Object.defineProperty(t.prototype,"id",{get:function(){return this.je.sessionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diagnostics",{get:function(){return this.je.diagnostics},enumerable:!0,configurable:!0}),t.prototype.run=function(t,i,e){return this.je.run(t,i,e)},t.prototype.boot=function(t,i){return this.je.run(mt.boot,t,i)},t.prototype.dispose=function(t){return this.je.run(mt.dispose,void 0,t)},t}(),Ut=function(){function t(t,i,e){var o=this;this.Je="",this.Le="",this.Ve=!1,this.ze=!1,this.qe=!1,this.Ge=function(t){var i=!1,e=!0,s="",a=!1;if(o.Ze&&(i=!0,e=t.source===o.Ze),t.origin&&(a=(s=_(t.origin,2).toLowerCase())===o.Le),!o.Ve&&(!o.ze||a&&e)||o.$t.ULS.u(593232850,r.F,n.Info,"Window: available["+i+"] valid["+e+"]; Origin: valid["+a+"] expected["+o.Le+"] actual["+s+"]"),a&&(!o.qe||e)){var c;try{c=JSON.parse(t.data)}catch(t){return void o.$t.ULS.u(593232851,r.F,n.Info,"Failed to parse event data: "+Y(t))}var u=c.MessageId;if(u)if(o.$t.ULS.u(593232854,r.F,n.Info,"Received message: "+u+", correlation: "+c.CorrelationId),u!==wt.si&&u!==wt.Pi||o.setTargetOrigin(t.origin),c.Values&&c.Values.ackExpected&&(o.$t.ULS.u(593232855,r.F,n.Info,"Sending Ack back"),o.postMessage(gt.ie,void 0,c.CorrelationId)),o.$e){o.$t.ULS.u(593232856,r.F,n.Info,"Processing message: "+u);try{o.$e(c)}catch(t){o.$t.ULS.u(594556386,r.F,n.Error,"Message handler error: "+Y(t))}}else o.$t.ULS.u(591933923,r.F,n.Error,"No message handler");else(o.Ve||o.ze)&&o.$t.ULS.u(593232853,r.F,n.Info,"Missing message id")}},this.$t=i,this.setTargetOrigin(t),e&&this.setMessageHandler(e),window.addEventListener("message",this.Ge,!1)}return t.prototype.setTargetOrigin=function(t){var i=T(t).toLowerCase();this.Je&&this.Je!==i&&this.$t.ULS.u(593232847,r.F,n.Warning,"Updating origin: ["+this.Je+"]->["+i+"]"),this.Je=i,this.Le=_(i,2),this.Ve=b(i),this.ze=C(i)},t.prototype.setTargetWindow=function(t,i){void 0===i&&(i=!1),this.Ze=t,this.qe=i},t.prototype.setMessageHandler=function(t){this.$e=t},t.prototype.removeMessageHandler=function(){this.$e=void 0},t.prototype.postMessage=function(t,i,e){if(this.Ze){this.$t.ULS.u(593232849,r.F,n.Info,"Sending message: "+t);var o={MessageId:t,SendTime:j(),CorrelationId:e,Values:i};this.Ze.postMessage(JSON.stringify(o),this.Je)}else this.$t.ULS.u(593232848,r.F,n.Info,"Missing target to send message")},t.prototype.dispose=function(){window.removeEventListener("message",this.Ge,!1),this.$e=void 0},t}();!function(t){t.Xe="access_token",t.Ke="access_token_ttl",t.Qe="bundleSrc",t.Ye="bundleStaleness",t.tn="DocID",t.in="ETag",t.en="feature_status",t.nn="fileExtension",t.on="fileGetUrl",t.rn="fileName",t.sn="fileSize",t.an="forceSLR",t.cn="frameHeightPx",t.un="frameWidthtPx",t.hn="highContrast",t.fn="highDpi",t.dn="host_diagnostics",t.ln="hostName",t.pn="huictrls",t.vn="owner_id",t.mn="sc",t.wn="softBlockedBrowser",t.gn="templateUrl",t.In="touchMode",t.Sn="user_id"}(Ot||(Ot={}));function Pt(t,i){var e=T(i);t.setAttribute("allow","microphone "+e+"; camera "+e+";")}function Et(t,i){i[Ot.cn]=String(t.offsetHeight),i[Ot.un]=String(t.offsetWidth),i[Ot.In]=String(m()),i[Ot.hn]=String(w()),i[Ot.an]=String(I())}function Rt(t){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(i){return t&&t.ULS.u(591525084,r.F,n.Info,"Trust check error: "+Y(i)),!1}}var Ft,Wt=function(){function t(t,i){var e=this;this.bn=null,this.Cn=function(t){var i=t.target;e.bn=i.contentWindow,e.bn?e.yn.setTargetWindow(e.bn):e.$t.ULS.u(592524689,r.F,n.Error,"Content window not available")},function(t){if(void 0===t||void 0===t.appendChild)throw TypeError("Container")}(t),this.Tn=t,this._n=i,this.On=i+"_Form",this.An=Rt()}return Object.defineProperty(t.prototype,"element",{get:function(){return this.Tn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameId",{get:function(){return this._n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formId",{get:function(){return this.On},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTopFrameTrusted",{get:function(){return this.An},enumerable:!0,configurable:!0}),t.prototype.boot=function(t,i,e){this.$t=e,this.yn=new Ut(t,e,this.$e),this.Un&&this.bn?(Pt(this.Un,t),this.yn.setTargetWindow(this.bn),this.$t.ULS.u(588793045,r.F,n.Info,"Reuse iframe and content window")):(this.Un=function(t,i,e,n){var o=t.ownerDocument.createElement("iframe");return o.id=i,o.name=i,o.src="",o.title="Office on the web Frame",o.width="100%",o.height="100%",o.marginWidth="0",o.marginHeight="0",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.display="block",o.style.position="absolute",o.style.backgroundColor="transparent",o.style.border="none",o.frameBorder="0",o.setAttribute("allowfullscreen","true"),o.setAttribute("allowTransparency","true"),Pt(o,e),n&&o.addEventListener("load",n,{once:!0}),t.appendChild(o),o}(this.Tn,this._n,t,this.Cn),this.$t.ULS.u(588793046,r.F,n.Info,"Wac frame created")),Et(this.Un,i),this.Pn=function(t,i,e,n,o){var r=t.ownerDocument,s=r.createElement("form");for(var a in s.id=e,s.name=e,s.action=n,s.target=i,s.method="POST",o){var c=r.createElement("input");c.type="hidden",c.name=a,c.value=o[a],s.appendChild(c)}return t.appendChild(s),s}(this.Tn,this._n,this.On,t,i),this.Pn.submit()},t.prototype.setMessageHandler=function(t){this.$e=t,this.yn&&this.yn.setMessageHandler(t)},t.prototype.removeMessageHandler=function(){this.$e=void 0,this.yn&&this.yn.removeMessageHandler()},t.prototype.postMessage=function(t,i){this.yn&&this.yn.postMessage(t,i)},t.prototype.dispose=function(t,i){var e=this;return new Promise((function(n){if(e.Pn&&(e.Tn.removeChild(e.Pn),e.Pn=void 0),e.yn&&(e.yn.dispose(),e.yn=void 0,e.$e=void 0),e.$t=void 0,e.Un&&!t){var o=function(){e.Tn.removeChild(e.Un),e.Un=void 0,n()};i?o():(e.Un.src="about:blank",window.setTimeout(o,0))}else n()}))},t}(),Nt=function(){function t(t,i,e){var n=this;this.sessions=[],this.containers=[],this.En=function(t){n.Rn.dispatch(t)},function(t){if(void 0===t)throw new TypeError("ApplicationInitParams");var i=t.host;if(void 0===i||void 0===i.storageHostName)throw new TypeError("HostInfo");var e=t.user;if(void 0===e||void 0===e.id)throw new TypeError("UserInfo")}(t),this.Fn=t,this.Wn=i,this.Nn=e,this.Rn=new bt,v()}return Object.defineProperty(t.prototype,"name",{get:function(){return this.Wn.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return Z()},enumerable:!0,configurable:!0}),t.prototype.addEventListener=function(t){this.Rn.add(t)},t.prototype.removeEventListener=function(t){this.Rn.remove(t)},t.prototype.createContainer=function(t){var i="WacFrame_"+this.Wn.name+"_"+this.containers.length,e=new Wt(t,i);return this.containers.push(e),e},t.prototype.createSession=function(t){var i=new At(this.Fn,this.Wn,t,this,this.En,this.Nn);return this.sessions.push(i),i},t.prototype.dispose=function(t){var i=this,e=this.sessions.map((function(i){return i.dispose(t).catch((function(t){}))}));return Promise.all(e).then((function(t){return i.Rn.removeAll(),i.sessions=[],i.containers=[],{completion:"success"}}))},t}();function xt(t){return t.toLowerCase().indexOf("uiembed=1")>=0}function Mt(t){var i=t.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function kt(t,i){i&&i.Diagnostics&&Object.keys(i.Diagnostics).forEach((function(e){return t[e]=i.Diagnostics[e]}))}function Dt(t,i,e){i.ULS.u(596459999,r.F,e,"SessionTraces: "+JSON.stringify(t))}function Bt(t,i){i.Stop();var e=i.GetVisibilityChangeEvents();null!=e&&e.length>0&&(t.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,t.SessionTraces.tabSwitchDiagnostics=JSON.stringify(e)),i.Dispose()}function Ht(t,i,e){try{var o=function(t,i){var e=d({},i);delete e.UserId,delete e.OwnerId,delete e.WdParams;var n=e,o=i.WdParams?JSON.parse(JSON.stringify(i.WdParams).toLowerCase()):{};return n.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(t){o[t]&&(n.WdParams[t]=o[t])})),n.UiEmbedMode=xt(t),n.UiHostName=U(t,"uih")||"N/A",n.HostDomain=location?location.hostname:"",n}(i.applicationUrl,i.sessionInformation);o.Build=Z(),o.Region=y(i.applicationUrl);var s=d({},i.rebootOverrideData);delete s.ackExpected,delete s["ui-language"],delete s.wdUserSession,delete s.rebootMode,delete s.documentUrl,o.RebootOverride=s,i.diagnostics.HostInitDiagnostics&&(t.ULS.u(596444238,r.F,n.Info,"HostInitDiagnostics: "+JSON.stringify(i.diagnostics.HostInitDiagnostics)),o.SessionOrigin=i.diagnostics.HostInitDiagnostics.entryPoint),e&&t.ULS.u(595937313,r.F,n.Info,JSON.stringify(e));var a=i.wopiInfo;a&&a.AccessToken&&a.AccessTokenExpiry||t.ULS.u(595894553,r.F,n.Warning,"There are some missing parameters"),a&&(a.AccessToken&&(o.AccessTokenLength=a.AccessToken.length),o.AccessTokenExpiry=a.AccessTokenExpiry);var c=ht.Jt;o.JsApiVersion=i.featureManager.isFeatureEnabled(c)?"v1Wrapper":"v1",t.ULS.u(596444237,r.F,n.Info,JSON.stringify({session:o,client:et()}))}catch(i){t.ULS.u(590915460,r.F,n.Error,"Failed to log initialization info: "+Y(i))}}function jt(t){if("undefined"!=typeof navigator&&navigator.virtualKeyboard&&void 0!==navigator.virtualKeyboard.overlaysContent&&window===top)return navigator.virtualKeyboard.overlaysContent=t}!function(t){t.Unknown="Unknown",t.AppInitError="AppInitError",t.ApiDisabledError="ApiDisabledError",t.CannotLoadFirstPage="CannotLoadFirstPage",t.CannotLoadScript="CannotLoadScript",t.PageChangeError="PageChangeError",t.ZoomChangeError="ZoomChangeError",t.CannotLoadBundleItem="CannotLoadBundleItem",t.InvalidPageIndex="InvalidPageIndex",t.UnsupportedBundleVersion="UnsupportedBundleVersion",t.InvalidWopiInfo="InvalidWopiInfo",t.TimeoutWacReady="TimeoutWacReady",t.WacFailed="WacFailed"}(Ft||(Ft={}));var Jt,Lt=function(t,i,e,n,o){return new Promise((function(t){jt(i.overlayContent),e.container&&e.container.postMessage(gt.Ue,void 0),t({completion:"success"})}))};function Vt(t){return t.toLowerCase().indexOf("wordeditorframe.aspx")>0}function zt(t){return t.toLowerCase().indexOf("wordviewerframe.aspx")>0}function qt(t,i){void 0===i&&(i=!1);var e=t;return e=(e=e.replace(new RegExp("word-edit","i"),"word-view")).replace(new RegExp("/we/wordeditorframe.aspx","i"),"/wv/wordviewerframe.aspx"),i&&(e=P(e,"WordEditorFailedToLoad","1")),e}function Gt(t){var i=t;return i=(i=i.replace(new RegExp("word-view","i"),"word-edit")).replace(new RegExp("/wv/wordviewerframe.aspx","i"),"/we/wordeditorframe.aspx")}function Zt(t,i){var e=Vt(t.applicationUrl),o=zt(t.applicationUrl),s=xt(t.applicationUrl);return i.ULS.u(595640900,r.F,n.Info,"gotUiEmbedUrl:"+s+", gotEditUrl:"+e+", gotViewUrl:"+o),!e&&t.wopiPrecheckInfo.IrmEnabled?{isSingleStepBoot:!0,bootFlowType:s?Jt.wordUiEmbedIrmEnabledEarlyRedirect:Jt.unifiedIrmEnabled,ignoreWacFramePostMessages:!1}:e?t.wopiPrecheckInfo.ReadOnly&&s?{isSingleStepBoot:!0,bootFlowType:Jt.wordUiEmbedReadOnlyEarlyRedirect,ignoreWacFramePostMessages:!1}:t.wopiInfo||p()===l.IE?{isSingleStepBoot:!0,bootFlowType:Jt.unifiedSingleFlush,ignoreWacFramePostMessages:t.isCreateNew||!1}:{isSingleStepBoot:!1,bootFlowType:Jt.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1}:{isSingleStepBoot:!0,bootFlowType:o?Jt.unifiedViewActionUrl:Jt.unifiedNotEditOrViewActionUrl,ignoreWacFramePostMessages:!o}}function $t(t,i,e){void 0===e&&(e=!1);var n=t.applicationUrl;var o={jsApi:"1"},r=ht.Jt;if(o.jsapiver=t.featureManager.isFeatureEnabled(r)?"v1Wrapper":"v1",e&&(o.NewSession="1"),o.corrid=t.sessionId,o.usid=t.sessionId,o.sftc="1",t.applicationCustomSettings&&t.applicationCustomSettings.IsCore&&(o.core="1"),t.sessionInformation.HideViewerToolbar&&(o.hvt="1"),t.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),t.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(t.sessionInformation.HighContrastMode)),t.sessionInformation.SupportsAtMentions&&(o.sams="1"),t.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),t.sessionInformation.SupportsDocReboot){var s=t.sessionInformation.SupportsDocReboot;o.sdr=!0===s?"1":s.toString()}return t.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),t.sessionInformation.SupportsAuthToken&&(o.sat="1"),t.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),t.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),t.sessionInformation.HideHeader&&(o.hhdr="1"),t.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),t.sessionInformation.HideTitleInViewer&&(o.htv="1"),t.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),t.applicationCustomSettings&&t.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),t.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1"),t.sessionInformation.UIEmbed&&(o.uiEmbed="1"),t.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(t.sessionInformation.UiHostIntegrationType)),t.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(t.sessionInformation.MetaUiHostVersion)),t.applicationCustomSettings&&t.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),i.isSingleStepBoot?(i.bootFlowType===Jt.unifiedSingleFlush&&(t.isCreateNew||(o.instantedit="1",o.wopicomplete="1")),o.wdRedirectionReason=i.bootFlowType):(o.instantedit="1",o.fileSrc=encodeURIComponent(t.sessionInformation.HostName),o.pmOrigin=encodeURIComponent(T(window.location.href)),t.isCreateNew&&(o.new="1",t.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o.wdTpl="fromhost"))),t.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(t.wopiPrecheckInfo.PreseededSessionKey)),t.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(t.wopiPrecheckInfo.PreseededWacSessionId)),t.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=t.wopiPrecheckInfo.RequestedCallThrottling),t.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=t.wopiPrecheckInfo.ClientThrottlingProtection),function(t){0;return!1}()&&(o.instantshell="1"),t.applicationCustomSettings&&t.applicationCustomSettings.additionalApplicationParameters&&(o=d(d({},t.applicationCustomSettings.additionalApplicationParameters),o)),t.rebootOverrideData&&t.rebootOverrideData.queryOverrides&&(o=d(d({},o),t.rebootOverrideData.queryOverrides)),function(t,i,e,n,o){var r=E(t);"teams"!==r.uih&&"owa"!==r.uih||(r.hhdr="1");var s=t.indexOf("?"),a=-1===s?t.concat("?"):t.substring(0,s+1);i.UiLocale&&(r.ui=encodeURIComponent(i.UiLocale));i.DataLocale&&(r.rs=encodeURIComponent(i.DataLocale));i.HostSessionId&&(r.hid=encodeURIComponent(i.HostSessionId));i.DisableChat&&(r.dchat="1");i.SessionContext&&(r.sc=encodeURIComponent(i.SessionContext));e&&e.WopiSrc&&(r.wopisrc=encodeURIComponent(e.WopiSrc));i.CookieCompliant&&(r.mscc="1");n&&(n.entryPoint&&(r.wdorigin=encodeURI(n.entryPoint)),n.userClickTime&&(r.wdhostclicktime=n.userClickTime.toString()));r=d(d(d({},r),i.WdParams),o);var c={};for(var u in r)c[u.toLowerCase()]=r[u];var h=[];for(var u in c)c[u]&&h.push(u.concat("=",c[u]));return a.concat(h.join("&"))}(n,t.sessionInformation,t.wopiInfo,t.diagnostics.HostInitDiagnostics,o)}function Xt(t){return t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0"}!function(t){t.bootWithoutWopiInfo="",t.unifiedSingleFlush="Unified_SingleFlush",t.unifiedIrmEnabled="Unified_IrmEnabled",t.unifiedViewActionUrl="Unified_ViewActionUrl",t.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",t.forceSingleStepBoot="Force_SingleStepBoot",t.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",t.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect"}(Jt||(Jt={}));function Kt(t,i,e,n,o,r,s){return function(t,i,e,n){Et(t,n);var o=i.ownerDocument,r=o.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=e,r.target=t.name,r.method="POST",n){var a=o.createElement("input");a.type="hidden",a.name=s,a.value=n[s],r.appendChild(a)}return i.appendChild(r),r.submit(),t}(function(t,i,e,n){var o=t.ownerDocument.createElement("iframe");o.name=e||"WebApplicationFrame",o.id="WebApplicationFrame",o.src="",o.title="Office Online Frame",o.width="100%",o.height="100%",o.marginWidth="0",o.marginHeight="0",o.style.left="0",o.style.top="0",o.style.right="0",o.style.bottom="0",o.style.display="block",o.style.position="absolute",o.style.backgroundColor="transparent",o.style.border="none",o.frameBorder="0",o.setAttribute("allowfullscreen","true"),o.setAttribute("allowTransparency","true");var r=T(i);return o.setAttribute("allow","microphone "+r+"; camera "+r+";"),n&&(o.onload=n),t.appendChild(o),o}(t,i,o),t,i,e)}var Qt=function(){function t(t,i,e,n,o,r){var s=this;if(this.xn=!1,this.Mn=[],this.logWarningOnNoAppComplete=function(t){s.xn||ft(s.$t,t)},void 0===i)throw new TypeError("bootFlowInfo");if(i.isSingleStepBoot&&void 0===t.wopiInfo)throw new TypeError("wopiInfo");this.kn=t,this.Dn=i,this.$t=e,this.Bn=n,this.Hn=o,this.jn=r,this.Jn=t.diagnostics.AppInitDiagnostics,this.Ln=t.diagnostics.SessionTraces,this.Ln.wopiInitializeTime=j()}return t.prototype.Boot=function(){var t=this;this.$t.ULS.u(596444241,r.F,n.Info,"Initializing WAC frame");var i=$t(this.kn,this.Dn,!0),e=function(t,i){var e={};if(t.wopiInfo&&(e[Ot.Xe]=t.wopiInfo.AccessToken,e[Ot.Ke]=Xt(t.wopiInfo)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(e[Ot.Qe]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){var o=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();i.ULS.u(593503580,r.F,n.Info,"Content bundle staleness - "+o),e[Ot.Ye]=o}else i.ULS.u(593503581,r.F,n.Info,"Content bundle staleness does not exist");if(t.wopiPrecheckInfo.FileGetUrl&&(e[Ot.on]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.FileName){var s=t.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==s){var a=t.wopiPrecheckInfo.FileName.substring(s+1);a&&(e[Ot.nn]=a)}e[Ot.rn]=t.wopiPrecheckInfo.FileName}return t.newFileTemplateSource&&t.newFileTemplateSource.FileSize?e[Ot.sn]=t.newFileTemplateSource.FileSize.toString():t.wopiPrecheckInfo.FileSize&&(e[Ot.sn]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(e[Ot.Sn]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(e[Ot.vn]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(e[Ot.mn]=t.sessionInformation.SessionContext),t.diagnostics.HostInitDiagnostics&&(e[Ot.dn]=JSON.stringify({HostInitializeDiagnostics:t.diagnostics.HostInitDiagnostics})),e[Ot.en]=pt(t.featureManager,t.sessionInformation.WdParams),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(e[Ot.pn]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),e[Ot.fn]=String(window.devicePixelRatio>1.24),e[Ot.wn]=String(g()),e[Ot.ln]=t.sessionInformation.HostName,t.newFileTemplateSource&&(e[Ot.gn]=t.newFileTemplateSource.FileGetUrl),t.newFileTemplateSource&&t.newFileTemplateSource.DocUniqueId?e[Ot.tn]=t.newFileTemplateSource.DocUniqueId:t.wopiPrecheckInfo.DocUniqueId&&(e[Ot.tn]=t.wopiPrecheckInfo.DocUniqueId),t.newFileTemplateSource&&t.newFileTemplateSource.ETag?e[Ot.in]=t.newFileTemplateSource.ETag:t.wopiPrecheckInfo.ETag&&(e[Ot.in]=t.wopiPrecheckInfo.ETag),e}(this.kn,this.$t);if(ct(b(i),this.kn.At,this.$t,this.logWarningOnNoAppComplete),this.Bn.registerMessagePayloadHandler(wt.ri,(function(i){t.handleWacAppBootState(i)})),this.Bn.registerMessagePayloadHandler(wt.hi,(function(){t.handleCloseTab()})),this.Bn.registerMessagePayloadHandler(wt.Ti,(function(i){t.handleTrustFrameRequest(i)})),this.Bn.registerMessagePayloadHandler(wt.Li,(function(i){t.handleSetOverlayContent(i)})),this.Dn.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(i,e),this.Dn.ignoreWacFramePostMessages){var o=this.getApplicationState();this.Hn(o)}return this.$t.ULS.u(595661019,r.F,n.Info,"Created Wac Frame"),this.Vn},t.prototype.bootWacFrame=function(t,i){this.Jn.officeFrameCreateTime=j(),this.Ln.frameCreateStartTime=this.Jn.officeFrameCreateTime;var e=this.kn.applicationCustomSettings&&this.kn.applicationCustomSettings.appFrameName;this.Vn=Kt(this.kn.container,t,i,this.kn.featureManager,e,this.$t,this.kn.sessionId),this.Bn.activate(this.Vn)},t.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var t=this;this.Bn.registerMessagePayloadHandler(wt.si,(function(i){t.handleWacCompleteMessage(i)})),this.Bn.registerMessagePayloadHandler(wt.oi,(function(i){t.handleWacFailureMessage(i)})),this.Mn.push(window.setTimeout((function(){return t.timeoutWacAppCompleteOrFail()}),15e3)),this.Mn.push(window.setTimeout((function(){return t.logWarningOnNoAppComplete(1)}),this.kn.At.getValue(L.gt,6e4))),this.Mn.push(window.setTimeout((function(){return t.logWarningOnNoAppComplete(2)}),this.kn.At.getValue(L.It,18e4)))},t.prototype.handleWacAppBootState=function(t){var i=t&&t.state?t.state:"unknown";this.$t.ULS.u(595714271,r.F,n.Info,"WAC Boot App state:["+i+"]")},t.prototype.handleTrustFrameRequest=function(t){var i=Rt(this.$t);this.$t.ULS.u(595653903,r.F,n.Info,"Top frame is trusted: "+i),this.Bn.sendPostMessage(this.Vn.contentWindow,gt.Ti,{isTopFrameTrusted:i})},t.prototype.handleSetOverlayContent=function(t){var i=jt(t&&t.overlayContent);this.$t.ULS.u(587487432,r.F,n.Info,"Overlay content: "+i),this.Bn.sendPostMessage(this.Vn.contentWindow,gt.Ue,void 0)},t.prototype.handleWacCompleteMessage=function(t){if(this.$t.ULS.u(595986314,r.F,n.Info,"Received wac complete message"),this.$t.ULS.flush(),ut(),this.clearLogTimers(),this.xn)this.$t.ULS.u(596444234,r.F,n.Info,"Received multiple wac complete or failure messages");else{this.xn=!0,this.sendWacPostMessage(gt.se,{}),kt(this.Jn,t);var i=this.getApplicationState();this.Hn(i),this.sendJsApiDiagnosticsToWacFrame(this.kn.diagnostics)}},t.prototype.handleCloseTab=function(){this.$t.ULS.u(579342464,r.F,n.Info,"Received close tab message");try{window.close()}catch(t){this.$t.ULS.u(579213188,r.F,n.Warning,"Failed to close the browser tab")}},t.prototype.getApplicationState=function(){return{innerApplicationFrame:this.Vn}},t.prototype.handleWacFailureMessage=function(t){if(this.$t.ULS.u(595986315,r.F,n.Error,"Received wac failed message"),this.$t.ULS.flush(),ut(),this.clearLogTimers(),this.xn)this.$t.ULS.u(596444235,r.F,n.Info,"Received multiple wac complete or failure messages");else{this.xn=!0,this.sendWacPostMessage(gt.re,{});var i={errorType:Ft.WacFailed,errorObject:{}};t&&(i.errorObject=t.Error,this.Ln.error=i),this.jn(i)}},t.prototype.timeoutWacAppCompleteOrFail=function(){this.xn||this.$t.ULS.u(596444236,r.F,n.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.Ln))},t.prototype.clearLogTimers=function(){dt(this.Mn),this.Mn=[]},t.prototype.sendJsApiDiagnosticsToWacFrame=function(t){this.sendWacPostMessage(gt.de,{HostInitializeDiagnostics:t.HostInitDiagnostics})},t.prototype.sendWacPostMessage=function(t,i){this.Vn&&this.Vn.contentWindow?this.Bn.sendPostMessage(this.Vn.contentWindow,t,i):this.$t.ULS.u(595955718,r.F,n.Info,"Attempted to send postmessage: "+t)},t}(),Yt=!1,ti=!1;function ii(){Yt=!1}function ei(t,i,e,o,s,a,c){if(i.ULS.u(595714433,r.F,n.Info,"Starting disposing the application. unloadApp:"+t+"; disposed:"+Yt+"; unloading:"+ti),Yt||ti&&t)i.ULS.u(595714908,r.F,n.Info,"Application is already disposed or unloading");else{var u,h={logger:i,postMessenger:e,innerApplicationFrame:o,onDisposed:s,onFrameRemoved:a,unloadTimeoutInMs:c||1e3,forceAppUnload:!1,disposeStartTime:j(),appUnloadTimedOut:!1};if(t&&o)return ti=!0,h.forceAppUnload=!0,(u=h).forceAppUnloadStartTime=j(),u.logger.ULS.u(595855490,r.F,n.Info,"Sending postmessage to unload app"),u.logger.ULS.flush(),u.postMessenger.registerMessagePayloadHandler(wt.Gi,(function(t){return function(t,i){t.forceAppUnloadEndTime=j(),t.appUnloadedMessageValues=i,t.logger.ULS.u(595855491,r.F,n.Info,"AppUnloaded received from app"),ni(t)}(u,t)})),u.postMessenger.sendPostMessage(u.innerApplicationFrame.contentWindow,gt.Re,{}),void window.setTimeout((function(){return function(t){!ti&&Yt||(t.appUnloadTimedOut=!0,t.logger.ULS.u(595855492,r.F,n.Info,"ApplicationUnload timed out, forcing dispose"),ni(t))}(u)}),u.unloadTimeoutInMs);ni(h)}}function ni(t){if(!Yt)try{Yt=!0,ti=!1,function(t){if(!t.innerApplicationFrame)return;t.innerApplicationFrame.src="about:blank",window.setTimeout((function(){t.innerApplicationFrame&&t.innerApplicationFrame.parentElement&&t.innerApplicationFrame.parentElement.removeChild(t.innerApplicationFrame),t.onFrameRemoved&&t.onFrameRemoved()}),0)}(t),function(t){var i={disposeStartTime:t.disposeStartTime,disposeEndTime:j(),forceAppUnload:t.forceAppUnload,appUnloadTimedOut:t.appUnloadTimedOut};t.forceAppUnloadStartTime&&(i.appUnloadStartTime=t.forceAppUnloadStartTime);t.forceAppUnloadEndTime&&(i.appUnloadEndTime=t.forceAppUnloadEndTime);if(t.appUnloadedMessageValues){var e=t.appUnloadedMessageValues,o=Number(e.hostMessageReceived);t.forceAppUnloadStartTime&&!isNaN(o)&&(i.hostToAppPostMessageLatency=o-t.forceAppUnloadStartTime);var s=Number(e.appMessageSent);!isNaN(s)&&t.forceAppUnloadEndTime&&(i.appToHostPostMessageLatency=t.forceAppUnloadEndTime-s);var a=Number(e.appUnloadStart),c=Number(e.appUnloadEnd);if(isNaN(a)||isNaN(c)||(i.appUnloadLatency=c-a),e.serverTimings){var u=e.serverTimings;for(var h in u)i["st-"+h.toString()]=u[h]}}t.logger.ULS.u(595855436,r.F,n.Info,"App disposed "+JSON.stringify(i)),t.logger.ULS.flushOnClose()}(t),t.onDisposed&&t.onDisposed()}catch(i){t.logger.ULS.u(595714434,r.F,n.Error,"Error disposing: "+Y(i))}}var oi,ri=function(){function t(t,i,e,n,o,r,s){var a=this;this.zn=!1,this.qn=!1,this.Gn=!1,this.Zn=null,this.$n=!0,this.Xn=!1,this.Kn=!1,this.kn=t,this.Dn=i,this.Jn=t.diagnostics.AppInitDiagnostics,this.$t=e,this.Bn=n,this.Hn=r,this.jn=s,this.Ln=t.diagnostics.SessionTraces,this.Ln.wopiPendingInitializeTime=j(),this.Qn=o,ii(),window.setTimeout((function(){return a.timeoutCompleteOrFail()}),5e3)}return t.prototype.Complete=function(t,i){if(this.Gn)this.$t.ULS.u(596444184,r.F,n.Warning,"Complete called after Complete/Fail already called");else{this.$t.ULS.u(596444185,r.F,n.Info,"Complete called."),this.Gn=!0,this.Yn=t,this.Ln.wopiPendingCompleteTime=j();try{this.Dn.isSingleStepBoot?this.completeSingleStepFlow():this.completeTwoStepFlow(),this.zn&&this.sendWacPostMessage(gt.Pe,{}),this.updateBrowserHistoryForCreateNew(i)}catch(t){this.$t.ULS.u(596444186,r.F,n.Error,"Unexpected script error: "+Y(t))}finally{this.$t.ULS.flush()}}},t.prototype.Fail=function(t){this.Gn?this.$t.ULS.u(596444187,r.F,n.Warning,"Fail called after Complete/Fail already called"):(this.$t.ULS.u(596444188,r.F,n.Warning,"Fail called. Reason: "+(t?JSON.stringify(t):"N/A")),this.Gn=!0,this.Dn.isSingleStepBoot?this.failSingleStepFlow():this.failTwoStepFlow(t),this.$t.ULS.flush())},t.prototype.Dispose=function(t,i,e){var n=this;ei(t||!1,this.$t,this.Bn,this.Vn,(function(){delete n.Vn,i&&i(),n.Qn(),n.Bn.dispose()}),void 0,e)},t.prototype.Boot=function(){this.Dn.isSingleStepBoot||this.bootTwoStepFlow(),this.$t.ULS.flush()},t.prototype.bootTwoStepFlow=function(){var t=this;this.$t.ULS.u(596444231,r.F,n.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout((function(){return t.timeoutWacReadyMessage()}),5e3),this.Bn.registerMessagePayloadHandler(wt.ni,(function(i){t.handleWacReadyMessage(i)})),this.Bn.registerMessagePayloadHandler(wt.Ji,(function(i){t.handleWacFrameSessionCompleteAckMessage(i)}));var i=new Qt(this.kn,this.Dn,this.$t,this.Bn,this.Hn,this.jn);this.Vn=i.Boot()},t.prototype.completeTwoStepFlow=function(){var t={ParallelizeStartSession:this.$n,WacFrameIsLoaded:this.zn,WacAcceptsStartSessionComplete:this.Xn};this.$t.ULS.u(596444232,r.F,n.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(t)),!this.$n||this.zn&&!this.Xn?this.zn&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},t.prototype.completeSingleStepFlow=function(){this.$t.ULS.u(596444233,r.F,n.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.kn.wopiInfo=this.Yn;var t=new Qt(this.kn,this.Dn,this.$t,this.Bn,this.Hn,this.jn);this.Vn=t.Boot()},t.prototype.failTwoStepFlow=function(t){this.zn?(this.$t.ULS.u(595968481,r.F,n.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(t)):(this.$t.ULS.u(595968482,r.F,n.Warning,"Fail was called on the session prior to WacReady."),this.Zn=t)},t.prototype.sendFailurePostMessageToWacFrame=function(t){this.$t.ULS.u(596444189,r.F,n.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(gt.Ae,t)},t.prototype.failSingleStepFlow=function(){this.$t.ULS.u(596444190,r.F,n.Warning,"Fail called during single step boot, calling host failure callback..."),this.jn({errorType:Ft.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},t.prototype.timeoutWacReadyMessage=function(){this.zn||(this.$t.ULS.u(596444191,r.F,n.Warning,"Timeout Wac Ready"),this.jn({errorType:Ft.TimeoutWacReady,errorObject:void 0}))},t.prototype.timeoutCompleteOrFail=function(){this.Gn||(this.Ln.timeoutCompleteOrFail=j(),this.$t.ULS.u(596444192,r.F,n.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.Ln)))},t.prototype.timeoutWacSessionCompletionMessageAck=function(t,i,e){this.Kn||(this.$t.ULS.u(596444193,r.F,n.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(t,i,e+1))},t.prototype.handleWacReadyMessage=function(t){if(this.Ln.readyMessageReceiveTime=j(),this.sendWacPostMessage(gt.ee,{}),this.zn)this.$t.ULS.u(596444194,r.F,n.Info,"Received multiple ready messages - frame is already loaded.");else{this.zn=!0,this.Xn=t&&t.CanAcceptStartSessionComplete;var i={AcceptStartSessionComplete:this.Xn,ParallelizeStartSession:this.$n,StartSessionResponse:null!=this.to,WopiInfo:null!=this.Yn};this.$t.ULS.u(596444195,r.F,n.Info,"HandleWacReadyMessage - "+JSON.stringify(i)),this.Gn&&(this.Zn?this.sendFailurePostMessageToWacFrame(this.Zn):this.sendWacPostMessage(gt.Pe,{})),this.$n&&this.Xn?this.to&&this.startSessionCompleted():this.Yn&&this.sendWopiInfoToWacFrame(),kt(this.Jn,t)}},t.prototype.handleWacFrameSessionCompleteAckMessage=function(t){this.Kn=!0,this.Ln.sessionCompleteAckReceivedTime=j()},t.prototype.sendWacPostMessage=function(t,i){this.Vn&&this.Bn.sendPostMessage(this.Vn.contentWindow,t,i)},t.prototype.sendSessionCompletionMessageWithRetry=function(t,i){this.sendSessionCompletionMessageWithRetryHelper(t,i,1)},t.prototype.sendSessionCompletionMessageWithRetryHelper=function(t,i,e){var o=this;if(e>3)this.$t.ULS.u(596444224,r.F,n.Error,"Attempted to call complete, but received no ack from the frame. Time: "+j());else{this.$t.ULS.u(596444225,r.F,n.Info,"Sending completion message to frame. Attempt number: "+e+", Time: "+j());var s=j();1===e&&(this.to&&this.to.Diagnostics&&(this.to.Diagnostics.completeMessageCreateTime=s),this.Ln.completeMessageCreateTime=s),i.Diagnostics.completeMessageSendTime=s,this.Ln.completeMessageSendTime=s,this.sendWacPostMessage(t,i),window.setTimeout((function(){return o.timeoutWacSessionCompletionMessageAck(t,i,e)}),1e3)}},t.prototype.makeStartSessionRequest=function(){var t=this;this.$t.ULS.u(596444226,r.F,n.Info,"Making parallelized startSession request.");var i=this.buildStartSessionUrl(this.Yn),e={"Content-Type":"application/x-www-form-urlencoded"},o="access_token="+encodeURIComponent(this.Yn.AccessToken)+"&access_token_ttl="+encodeURIComponent(Xt(this.Yn));this.Ln.startSessionStartTime=j(),function(t,i,e,n){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{n&&n(o)}finally{null!=o&&(o.onreadystatechange=function(){})}}},o.open("POST",t),e)o.setRequestHeader(r,e[r]);o.send(i)}(i,o,e,(function(i){return t.onStartSessionRequestCompleted(i)}))},t.prototype.onStartSessionRequestCompleted=function(t){if(this.Ln.startSessionCompleteTime=j(),this.Ln.startSessionResponseStatus=t.status,this.to={StartSessionResponse:{RequestStatus:t.status,ResponseText:t.responseText},Diagnostics:{wopiPendingInitializeTime:this.Ln.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Ln.wopiPendingCompleteTime,startSessionStartTime:this.Ln.startSessionStartTime,startSessionCompleteTime:this.Ln.startSessionCompleteTime,readyMessageReceiveTime:this.Ln.readyMessageReceiveTime}},this.$t.ULS.u(596444227,r.F,n.Info,"StartSession request completed with status code: "+this.to.StartSessionResponse.RequestStatus+", Time: "+j()),this.zn&&this.Xn)this.startSessionCompleted();else{var i={WacFrameIsLoaded:this.zn,InitializeCompleted:this.qn};this.$t.ULS.u(596444228,r.F,n.Info,"StartSessionCompleted not called - "+JSON.stringify(i))}},t.prototype.sendWopiInfoToWacFrame=function(){if(!this.qn){this.qn=!0,this.$t.ULS.u(596444229,r.F,n.Info,"Sending wopi info to the frame.");var t={WopiDetails:{WopiSrc:this.Yn.WopiSrc,AccessToken:this.Yn.AccessToken,AccessTokenTtl:Xt(this.Yn)},Diagnostics:{wopiPendingInitializeTime:this.Ln.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Ln.wopiPendingCompleteTime,readyMessageReceiveTime:this.Ln.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(gt.ce,t)}},t.prototype.startSessionCompleted=function(){200===this.to.StartSessionResponse.RequestStatus?this.qn||(this.qn=!0,this.sendSessionCompletionMessageWithRetry(gt.ae,this.to)):this.sendWopiInfoToWacFrame()},t.prototype.buildStartSessionUrl=function(t){var i=this.kn.applicationBasePath+"wordeditorstartsession.ashx",e=$t(this.kn,this.Dn,!1);return i=P(i+="?"+e.substring(e.indexOf("?")+1),"WOPISrc",encodeURIComponent(t.WopiSrc)),i=P(i,"build",encodeURIComponent(Z())),i=P(i,"WacUserType",encodeURIComponent("WOPI")),this.kn.wopiPrecheckInfo.FileGetUrl&&(i=P(i,"fileGetUrlPresent","1")),i},t.prototype.updateBrowserHistoryForCreateNew=function(t){if(this.kn.isCreateNew){if(!t||!t.NewFilePath)return void this.$t.ULS.u(596444230,r.F,n.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",t.NewFilePath),t.UpdatedPageTitle&&(document.title=t.UpdatedPageTitle)}},t}(),si=function(){function t(t,i,e,n,o,r,s){this.io=!1,this.eo=!1,this.no=!1,this.oo=6e4,this.kn=t,this.Jn=t.diagnostics.AppInitDiagnostics,this.$t=e,this.Bn=n,this.Ln=t.diagnostics.SessionTraces,this.Qn=o;var a=window.navigator.userAgent;a.indexOf("Mobi")>=0&&a.indexOf("iPad")<0&&(this.no=!0),this.Hn=r,this.jn=s,this.ro=this.no?r:this.getSuccessCallbackProxy(),this.so=this.no?s:this.getFailureCallbackProxy(),this.ao=!(!this.kn.applicationCustomSettings||!this.kn.applicationCustomSettings.IsCore),this.kn.sessionInformation&&this.kn.sessionInformation.WdParams&&(this.kn.applicationCustomSettings&&this.kn.applicationCustomSettings.ForceAccessibilityMode?this.kn.sessionInformation.WdParams.wdAccPdf="1":this.ao&&(this.kn.sessionInformation.WdParams.wdAccPdf="0")),this.co=new ri(this.kn,i,e,n,o,this.ro,this.so)}return t.prototype.Complete=function(t){this.kn.diagnostics.HostInitDiagnostics&&(this.kn.diagnostics.HostInitDiagnostics.hostCompleteCallTime=j()),this.co.Complete(t)},t.prototype.Fail=function(t){this.co.Fail(t)},t.prototype.Dispose=function(t,i,e){var n=this;ei(t||!1,this.$t,this.Bn,this.Vn,(function(){delete n.Vn,i&&i(),n.Qn(),n.Bn.dispose()}),void 0,e)},t.prototype.Boot=function(){var t=this;if(this.no)this.$t.ULS.u(595932544,r.O,n.Info,"Mobile Endpoint detected, skipping first page viewer optimization");else{this.$t.ULS.u(595989253,r.O,n.Info,"Boot WordViewer"),this.Bn.registerMessagePayloadHandler(wt.$i,(function(i){t.handleWacPageCountInit(i)})),this.Bn.registerMessagePayloadHandler(wt.Wi,(function(i){t.handleWacCurrentPageInit(i)})),this.Bn.registerMessagePayloadHandler(wt.te,(function(i){t.handleWacZoomLevelInit(i)}));var i=this.kn.rebootOverrideData;i&&i.reason&&"translate"===i.reason.toLowerCase()?this.$t.ULS.u(591209105,r.O,n.Info,"Skip first page optimization"):this.kn.wopiPrecheckInfo.BundleInfo?this.kickOffFirstPageOptimization(this.kn.wopiPrecheckInfo.BundleInfo,this.kn.container,(function(){t.uo=j(),t.$t.ULS.u(595998873,r.O,n.Info,"FirstPageFromHostLoadTime: "+t.uo),t.Jn.documentLoadedTime=t.Jn.documentLoadedTime||t.uo,t.Vn&&t.Vn.contentWindow&&t.postFastBootOptimizationTime(t.Vn.contentWindow,t.uo)}),(function(i){t.removeFirstPageContainer(),t.$t.ULS.u(595994571,r.O,n.Warning,"Cannot load first page from cache"),t.Jn.errorObject=i})):this.$t.ULS.u(596121033,r.O,n.Warning,"Missing Bundle Info"),window.setTimeout((function(){return t.timeoutAppInitialize()}),this.oo)}},t.prototype.postFastBootOptimizationTime=function(t,i){this.Bn.sendPostMessage(t,gt.fe,{HostCacheLoadTime:i})},t.prototype.kickOffFirstPageOptimization=function(t,i,e,o){var s=this;if(this.$t.ULS.u(595989254,r.O,n.Info,"Kick off OptimizationView"),!this.kn.applicationCustomSettings||!this.kn.applicationCustomSettings.ForceAccessibilityMode)if(t.Url){var a=i.ownerDocument;this.ho=a.createElement("div"),this.ho.id="FirstPageContainer",this.ho.style.left="0",this.ho.style.textAlign="center",this.ho.style.width="1px",this.ho.style.bottom="0",this.ho.style.zIndex="900",this.ho.style.height="1px",this.ho.style.position="absolute",this.ho.style.padding="0 29px",this.ho.style.right="0",this.ho.style.overflow="auto",this.ho.style.marginLeft="auto",this.ho.style.marginRight="auto",this.ho.style.maxWidth="100%",this.ao?this.ho.style.top="0":this.ho.style.top="90px",i.appendChild(this.ho);var c=a.createElement("img");c.id="FirstPageImage",c.style.marginTop="11px",c.style.marginBottom="11px",c.style.maxWidth="100%",c.style.border="solid 1px #d2d5d8",c.draggable=!1,c.onload=function(){s.$t.ULS.u(595989255,r.O,n.Info,"OptimizationView Loaded"),s.ho.style.width="",s.ho.style.height="",e()},c.onerror=function(t){o({errorType:Ft.CannotLoadFirstPage,errorObject:t.returnValue})},c.src=t.Url.replace("{0}","p1.img"),this.ho.appendChild(c)}else this.$t.ULS.u(595722645,r.O,n.Info,"Missing Url in provided Bundle Info, from host: "+this.kn.sessionInformation.HostName)},t.prototype.tryInitializeApplication=function(){if(!this.eo&&this.io&&(!this.ao||this.fo&&this.do&&this.lo)){this.Bn.removeMessageHandler(wt.$i),this.Bn.removeMessageHandler(wt.Wi),this.Bn.removeMessageHandler(wt.te);var t={isCore:this.ao,pageCount:this.do,currentPage:this.fo,zoomLevel:this.lo,innerApplicationFrame:this.Vn};this.Hn(t),this.$t.ULS.u(595989256,r.O,n.Info,"Word Viewer Initialize Complete"),this.eo=!0,this.$t.ULS.flush()}},t.prototype.getSuccessCallbackProxy=function(){var t=this;return function(i){t.$t.ULS.u(595986312,r.O,n.Info,"SuccessCallbackProxy called"),t.Vn=i.innerApplicationFrame,t.Vn&&t.Vn.contentWindow&&t.uo&&t.postFastBootOptimizationTime(t.Vn.contentWindow,t.uo),t.removeFirstPageContainer();var e=t.Jn.documentLoadedTime;e&&t.uo&&t.uo<e?(t.Jn.documentLoadedTime=t.uo,t.Jn.documentLoadedFromWopiPrecheckInfo=!0,t.$t.ULS.u(595994572,r.O,n.Info,"First page load from cache was faster")):t.Jn.documentLoadedFromWopiPrecheckInfo=!1,t.sendAckMessages(),t.io=!0,t.$t.ULS.u(595986313,r.O,n.Info,"WordViewerInitializer received wac complete message"),t.tryInitializeApplication(),t.$t.ULS.flush()}},t.prototype.getFailureCallbackProxy=function(){var t=this;return function(i){t.$t.ULS.u(595972122,r.O,n.Error,"FailureCallbackProxy called"),t.eo=!0,t.jn(i)}},t.prototype.removeFirstPageContainer=function(){this.ho&&this.ho.parentElement&&this.ho.parentElement.removeChild(this.ho)},t.prototype.timeoutAppInitialize=function(){if(!this.eo){this.Ln.timeoutAppInitialize=j();var t="Didn't receive app initialize post messages. {'appComplete': "+this.io+", 'currentPage': "+(void 0!==this.fo)+", 'zoomLevel': "+(void 0!==this.lo)+", 'pageCount': "+(void 0!==this.do)+"}";this.$t.ULS.u(596120771,r.O,n.Warning,t)}},t.prototype.handleWacPageCountInit=function(t){if(!t||"number"!=typeof t.pageCount)throw new TypeError("values: PageCount not found");this.do=t.pageCount,this.sendWacPostMessage(gt.Fe,{}),this.tryInitializeApplication()},t.prototype.handleWacCurrentPageInit=function(t){if(!t||"number"!=typeof t.newPage)throw new TypeError("values: CurrentPage not found");this.fo=t.newPage,this.sendWacPostMessage(gt.le,{}),this.tryInitializeApplication()},t.prototype.handleWacZoomLevelInit=function(t){if(!t||"number"!=typeof t.newLevel)throw new TypeError("values: ZoomLevel not found");this.lo=t.newLevel,this.sendWacPostMessage(gt.We,{}),this.tryInitializeApplication()},t.prototype.sendAckMessages=function(){this.fo&&this.sendWacPostMessage(gt.le,{}),this.do&&this.sendWacPostMessage(gt.Fe,{}),this.lo&&this.sendWacPostMessage(gt.We,{})},t.prototype.sendWacPostMessage=function(t,i){this.Vn&&this.Vn.contentWindow?this.Bn.sendPostMessage(this.Vn.contentWindow,t,i):this.$t.ULS.u(595955717,r.O,n.Info,"Attempted to send WordViewer postmessage: "+t)},t}(),ai=((oi={})[mt.blurFocus]=gt.oe,oi[mt.continueAccessibilityLoop]=gt.ue,oi[mt.grabFocus]=gt.he,oi[mt.popState]=gt.pe,oi[mt.rename]=gt.me,oi[mt.sendAccessToken]=gt.we,oi[mt.sendAuthToken]=gt.ge,oi[mt.sendCustomAuthConfig]=gt.Ie,oi[mt.sendEmbeddedViewUrl]=gt.be,oi[mt.sendSessionInfo]=gt.Ce,oi[mt.sendUserAccessAndPermissions]=gt.ye,oi[mt.sendWopiInfo]=gt.Te,oi[mt.switchMode]=gt.Ee,oi),ci=function(){function t(t,i){var e=this;if(this.po=!1,this.vo=function(t){return e.handleWacFramePostMessage(t)},this.qe=!1,this.Ve=!1,this.ze=!1,this.mo={},!t)throw new Error("Missing origin for PostMessageHandler");this.Ve=b(t),this.ze=C(t),this.$t=i,this.setOrigin(t)}return t.prototype.registerMessagePayloadHandler=function(t,i){if(this.mo[t])throw new Error("Duplicate registration!");this.mo[t]=i},t.prototype.removeMessageHandler=function(t){delete this.mo[t]},t.prototype.sendPostMessage=function(t,i,e){if(t){this.$t.ULS.u(596464334,r.F,n.Info,"Sending message: "+i);var o={MessageId:i,SendTime:j(),Values:e};this.sendPostMessageInternal(t,JSON.stringify(o),this.Je)}else this.$t.ULS.u(595948308,r.F,n.Info,"Missing target for SendPostMessage")},t.prototype.activate=function(t,i){void 0===i&&(i=!1),this.Vn=t,this.qe=i,this.po||(window.addEventListener("message",this.vo,!1),this.po=!0)},t.prototype.postMessageForCommand=function(t,i,e){var o=ai[i];o?(this.$t.ULS.u(595702598,r.F,n.Info,"Sending message "+o+" for command "+i),this.sendPostMessage(t,o,e)):this.$t.ULS.u(595702599,r.F,n.Warning,"No mapping for command "+i)},t.prototype.dispose=function(){for(var t=0,i=Object.keys(this.mo);t<i.length;t++){var e=i[t];delete this.mo[e]}this.po&&(window.removeEventListener("message",this.vo,!1),this.po=!1)},t.prototype.sendAckBack=function(t,i,e){if(t){var o={MessageId:gt.ie,CorrelationId:e,SendTime:j()};this.$t.ULS.u(595732176,r.F,n.Info,"Sending Ack back"),t.postMessage(JSON.stringify(o),i)}else this.$t.ULS.u(595736136,r.F,n.Info,"Missing target to send Ack back")},t.prototype.handleWacFramePostMessage=function(t){var i=!1,e=!0,o="",s=!1;if(this.Vn&&this.Vn.contentWindow&&(i=!0,e=t.source===this.Vn.contentWindow),t.origin&&(s=(o=_(t.origin,2).toLowerCase())===this.Le),!this.Ve&&(!this.ze||s&&e)||this.$t.ULS.u(595730526,r.F,n.Info,"Window is available: "+i+", window is valid: "+e+", origin is valid: "+s+", expected origin: "+this.Le+", actual origin: "+o),s&&(!this.qe||e)){var a;try{a=JSON.parse(t.data)}catch(t){return void this.$t.ULS.u(596464282,r.F,n.Info,"Failed to parse event data: "+Y(t)+".")}var c=a.MessageId;if(c){this.$t.ULS.u(595714715,r.F,n.Info,"Received messageId: "+c+", correlation: "+a.CorrelationId),c!==wt.si&&c!==wt.Pi||this.setOrigin(t.origin),a.Values&&a.Values.ackExpected&&this.sendAckBack(t.source,t.origin,a.CorrelationId);var u=this.mo[c];if(u){this.$t.ULS.u(596464288,r.F,n.Info,"Processing message: "+c);try{u(a.Values||{})}catch(t){this.$t.ULS.u(593773704,r.F,n.Error,"Handler error: "+Y(t))}}else this.$t.ULS.u(596464289,r.F,n.Info,"No handler found for message id: "+c)}else(this.Ve||this.ze)&&this.$t.ULS.u(595730520,r.F,n.Info,"Could not find message id")}},t.prototype.sendPostMessageInternal=function(t,i,e){t.postMessage(i,e)},t.prototype.setOrigin=function(t){var i=t.toLowerCase();this.Je&&this.Je!==i&&this.$t.ULS.u(596128131,r.F,n.Warning,"Updating origin:"+this.Je+"->"+i),this.Je=i,this.Le=_(i,2),this.Ve=b(i),this.ze=C(i)},t}(),ui=function(){function t(){var t=this;if(this.wo=[],this.mo=[],this.Io=function(){return t.handleVisibilityChange()},"hidden"===document.visibilityState){var i={visibility:document.visibilityState,time:j(),initialState:!0};this.wo.push(i)}document.addEventListener("visibilitychange",this.Io)}return t.prototype.RegisterEventHandler=function(t){this.mo.push(t)},t.prototype.RemoveEventHandler=function(t){if(t){var i=this.mo.indexOf(t);this.mo.splice(i,1)}},t.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.Io)},t.prototype.GetVisibilityChangeEvents=function(){return this.wo},t.prototype.Dispose=function(){this.Stop(),this.mo=[],this.wo=[]},t.prototype.handleVisibilityChange=function(){var t={visibility:document.visibilityState,time:j(),initialState:!1};this.wo.push(t);for(var i=0,e=this.mo;i<e.length;i++){var n=e[i];n&&n(t)}},t}();function hi(t,i,e,n,o,r){void 0===r&&(r=!1),t.SessionInformation.IsCore&&(t.SessionInformation.HideViewerToolbar=!0),function(t,i){var e=t.SessionInformation;e.WdParams||(e.WdParams={});if(e.WdParams.wd)return;i.substring(1).split("&").filter((function(t){if(0===t.indexOf("wd")){var i=t.split("=");i[0].length>2&&(e.WdParams[i[0]]=i[1])}}));var n=t.RebootOverrideData;n&&n.previousSessionId&&(e.WdParams.wdprevioussession=n.previousSessionId)}(t,window.location.search);var s=o||new Ct("Word",e);return{container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:t.Diagnostics,AppInitDiagnostics:{officeSessionId:i,officeBootstrapperVersion:Z(),hostName:t.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:i,applicationBasePath:Mt(t.ApplicationUrl),wopiInfo:t.WopiInfo,forceSingleStepBoot:r,isCreateNew:t.WopiPrecheckInfo.IsNewFile||W(t.ApplicationUrl),featureManager:n||lt(t.FnIsFeatureEnabled,e),At:s,newFileTemplateSource:t.NewFileTemplateSource,rebootOverrideData:t.RebootOverrideData}}var fi,di=function(){function t(t,i){this.So=t,this.bo=i}return t.prototype.GetVersion=function(){return Z()},t.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},t.prototype.Prefetch=function(t){if(null!=t&&void 0!==t){var i=document.createElement("link");i.rel="prefetch";var e=t.BootstrapperUrl;".js"!==e.toString().slice(-3)&&(e+=".js"),i.href=e;var n=document.getElementsByTagName("head")[0];null!=n&&void 0!==n&&n.appendChild(i)}},t.prototype.InitializeWopiPending=function(t,i,e,o,s,a){var c,u,h,f,l,p=!1;try{var m,w=j();!function(t){if(void 0===t)throw new TypeError("initParams");var i=t.Container;if(void 0===i||void 0===i.appendChild)throw new TypeError("Container");var e=t.SessionInformation;if(void 0===e||void 0===e.HostName||void 0===e.HostSessionId||void 0===e.UserId)throw new TypeError("SessionInformation");var n=t.ApplicationUrl;if(void 0===n||"string"!=typeof n)throw new TypeError("ApplicationUrl");var o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(t),function(t){var i,e=t.RebootOverrideData;e&&(i=e.mode)&&("view"===(i=i.toLowerCase())&&Vt(t.ApplicationUrl)?t.ApplicationUrl=qt(t.ApplicationUrl):"edit"===i&&zt(t.ApplicationUrl)&&(t.ApplicationUrl=Gt(t.ApplicationUrl)))}(t),e?h=e:(h=(c=Tt())[0],f=c[1]),u=i||q({remoteUlsEndpoint:Mt(t.ApplicationUrl)+"RemoteUls.ashx",sessionId:h}),l=hi(t,h,u,s,a,this.bo.forceSingleStepBoot),a||(l.At.addSettingsChangeListener(u.settingsChangeHandler),l.At.initializePeriodicFetch(l.applicationBasePath,h)),l.diagnostics.HostInitDiagnostics&&(l.diagnostics.HostInitDiagnostics.hostInitializeCallTime=w),Ht(u,l,f),p=!0,ot(u,!0);var g=t.BootstrapperUrl;g&&(m=this.periodicPrefetch(g,u));var I=function(){l.At.dispose(),rt(),window.clearInterval(m)},S=T(t.ApplicationUrl),b=o||new ci(S,u),C=new ui,y=function(t,i){var e={isSingleStepBoot:t.forceSingleStepBoot,bootFlowType:t.forceSingleStepBoot?Jt.forceSingleStepBoot:Jt.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(t.forceSingleStepBoot||(e=Zt(t,i)),e.isSingleStepBoot){var o={singleStepBootIsRequired:!0,singleStepBootReason:e.bootFlowType,irmEnabled:t.wopiPrecheckInfo.IrmEnabled,readOnly:t.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:e.ignoreWacFramePostMessages};i.ULS.u(596444182,r.F,o.irmEnabled?n.Warning:n.Info,JSON.stringify(o))}else i.ULS.u(596444183,r.F,n.Info,"Received input valid for two step flow");return e}(l,u),_=function(t,i,e,o,s,a,c,u){return function(h){Bt(t,s),Dt(t.SessionTraces,o,n.Info);var f=pi(t);o.ULS.u(596448985,r.F,n.Info,JSON.stringify(f));var d=u(i,o,e,a,h);try{c(d,f)}catch(t){o.ULS.u(595719171,r.F,n.Error,"Exception thrown from host's success callback: "+Y(t))}tt("word",o),li(o)}}(l.diagnostics,l.sessionId,b,u,C,I,t.FnOnInitializeSuccess,this.So),O=function(t,i,e,o){return function(s){Bt(t,e),Dt(t.SessionTraces,i,n.Warning);var a=pi(t);i.ULS.u(596448986,r.F,n.Error,JSON.stringify({error:s,appInitDiagnostics:a}));try{o(s,a)}catch(t){i.ULS.u(595719172,r.F,n.Error,"Exception thrown from host's failure callback: "+Y(t))}tt("word",i),li(i)}}(l.diagnostics,u,C,t.FnOnInitializeFailure);if(v(),t.FnOnAppModeSwitched&&b.registerMessagePayloadHandler(wt.Ei,t.FnOnAppModeSwitched),this.bo.useViewerInitializer||y.bootFlowType===Jt.unifiedViewActionUrl||y.bootFlowType===Jt.wordUiEmbedReadOnlyEarlyRedirect||y.bootFlowType===Jt.wordUiEmbedIrmEnabledEarlyRedirect){!this.bo.useViewerInitializer&&t.FnOnAppModeSwitched&&t.FnOnAppModeSwitched({NewMode:"view"}),y.bootFlowType===Jt.wordUiEmbedReadOnlyEarlyRedirect&&(l.applicationUrl=qt(l.applicationUrl,!0)),l.sessionInformation.HideViewerToolbar&&(l.applicationCustomSettings=d(d({},l.applicationCustomSettings),{IsCore:!0}),delete l.sessionInformation.HideViewerToolbar);var A=new si(l,y,u,b,I,_,O);return A.Boot(),A}if(t.WopiPrecheckInfo.ReadOnly&&t.FnOnAppModeSwitched&&t.FnOnAppModeSwitched({NewMode:"view"}),g&&this.bo.preloader&&this.bo.preloader.shouldPreload(l.applicationUrl))try{var P=g;0,l.featureManager.isFeatureEnabled(ht.Nt)&&(u.ULS.u(595645891,r.F,n.Info,"HTTP2 preload enabled"),P=F(g));var E=l.sessionInformation.UiLocale;E||(E=decodeURIComponent(U(l.applicationUrl,"ui"))),this.bo.preloader.preload(P,E,u,l.featureManager)}catch(t){u.ULS.u(595943884,r.F,n.Error,Y(t))}var R=new ri(l,y,u,b,I,_,O);return R.Boot(),R}catch(i){return u&&(u.ULS.u(596459925,r.F,n.Error,Ft.AppInitError+": "+Y(i)),p||Ht(u,l||hi(t,h,u,s,a,this.bo.forceSingleStepBoot),f),u.ULS.flushOnClose()),void t.FnOnInitializeFailure({errorType:Ft.AppInitError,errorObject:i},void 0)}},t.prototype.periodicPrefetch=function(t,i){var e=this;return window.setInterval((function(){e.Prefetch({BootstrapperUrl:t}),i.ULS.u(595895774,r.F,n.Info,"Prefetching "+R(t))}),36e5)},t}();function li(t){t.ULS.u(590914655,r.F,n.Info,"Time spent logging: "+t.getTimeSpentLogging())}function pi(t){return d(d(d({},t.AppInitDiagnostics),t.HostInitDiagnostics),{SessionTraces:t.SessionTraces})}!function(t){t.BrowserEvent="BrowserEvent",t.PageChanged="PageChanged",t.ZoomChanged="ZoomChanged",t.ContentRefreshBegin="ContentRefreshBegin",t.ContentRefreshEnd="ContentRefreshEnd",t.AppClosed="UI_Close",t.UserEdit="Edit_Notification",t.FileRename="File_Rename",t.FileShare="UI_Sharing",t.ShowFileVersions="UI_FileVersions",t.UIWorkflow="UI_Workflow",t.IsDisabled="IsDisabled",t.AccessibilityLoopComplete="App_AccessibilityLoopComplete",t.Unloaded="Unloaded",t.Disposed="Disposed",t.SwitchMode="App_SwitchMode",t.DocumentReboot="DocReboot",t.WopiInfoFromUrl="WopiInfoFromUrl",t.ModeSwitched="ModeSwitched",t.CreateNewDocument="App_CreateNewDocument",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.SetOverlayContent="SetOverlayContent"}(fi||(fi={}));var vi=[wt.gi,wt._i,wt.Di,wt.Xi],mi=function(){function t(t,i,e,n,o){this.mo={},this.Co=!1,this.yo=!1,this.To=t,this.$t=i,this.Vn=o.innerApplicationFrame,this.Bn=e,this._o=n,this.registerPostMessageHandlers(),ii()}return t.prototype.GetApplicationType=function(){throw new Error("Not implemented")},t.prototype.GetVersion=function(){return Z()},t.prototype.GetSessionId=function(){return this.To},t.prototype.RegisterEventHandler=function(t,i){if(this.yo)throw new Error("RegisterEventHandler is not supposed to be called");this.Co=!0,this.registerEventHandlerInternal(t,i)},t.prototype.RemoveEventHandler=function(t,i){if(this.yo)throw new Error("RemoveEventHandler is not supposed to be called");switch(t){case fi.Unloaded:case fi.Disposed:case fi.DocumentReboot:case fi.WopiInfoFromUrl:case fi.GetAuthToken:case fi.GetCustomAuthConfig:case fi.SetOverlayContent:if(this.mo[t]!==i)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.mo[t];break;default:this.Bn.removeMessageHandler(t)}},t.prototype.RegisterErrorHandler=function(t){},t.prototype.RemoveErrorHandler=function(t){},t.prototype.RegisterAllEventsHandler=function(t){var i=this;if(this.Co)throw new Error("RegisterAllEventsHandler is not supposed to be called");if(this.yo)throw new Error("RegisterAllEventsHandler is supposed to be called only once");this.yo=!0,vi.forEach((function(e){i.registerEventHandlerInternal(e,(function(i){return t({MessageId:e,SendTime:void 0,CorrelationId:void 0,Values:i})}))})),Object.keys(yt).forEach((function(e){yt[e].Me&&i.registerEventHandlerInternal(e,(function(i){return t({MessageId:e,SendTime:void 0,CorrelationId:void 0,Values:i})}))})),this.registerEventHandlerInternal(fi.WopiInfoFromUrl,(function(i){t({MessageId:wt.Ui,SendTime:void 0,CorrelationId:void 0,Values:i})})),this.registerEventHandlerInternal(fi.GetAuthToken,(function(i){t({MessageId:wt.Oi,SendTime:void 0,CorrelationId:void 0,Values:i})})),this.registerEventHandlerInternal(fi.GetCustomAuthConfig,(function(i){t({MessageId:wt.Ai,SendTime:void 0,CorrelationId:void 0,Values:i})})),this.registerEventHandlerInternal(fi.DocumentReboot,(function(i){t({MessageId:wt.Mi,SendTime:void 0,CorrelationId:void 0,Values:i})}))},t.prototype.PostCommand=function(t,i){this.Bn.postMessageForCommand(this.Vn.contentWindow,t,i)},t.prototype.Dispose=function(t,i){var e=this;ei(t||!1,this.$t,this.Bn,this.Vn,(function(){delete e.Vn,e._o(),e.Bn.dispose(),e.raiseEvent(fi.Unloaded,{})}),(function(){try{e.raiseEvent(fi.Disposed,{}),e.mo={}}catch(t){e.$t.ULS.u(589108815,r.F,n.Error,"onFrameRemoved error: "+Y(t))}}),i)},t.prototype.registerEventHandlerInternal=function(t,i){switch(t){case fi.Unloaded:case fi.Disposed:case fi.DocumentReboot:case fi.WopiInfoFromUrl:case fi.GetAuthToken:case fi.GetCustomAuthConfig:case fi.SetOverlayContent:if(this.mo[t])throw new Error("Duplicate registration");this.mo[t]=i;break;default:this.Bn.registerMessagePayloadHandler(t,i)}},t.prototype.registerPostMessageHandlers=function(){this.Bn.registerMessagePayloadHandler(wt.Mi,this.handleDocumentRebootMessage.bind(this)),this.Bn.registerMessagePayloadHandler(wt.Ui,this.handleWopiInfoFromUrlRequest.bind(this)),this.Bn.registerMessagePayloadHandler(wt.Oi,this.handleAuthTokenRequest.bind(this)),this.Bn.registerMessagePayloadHandler(wt.Ai,this.handleCustomAuthConfigRequest.bind(this))},t.prototype.raiseEvent=function(t,i){var e=this.mo[t];if(e)try{e(i||{})}catch(t){this.$t.ULS.u(593773706,r.F,n.Error,"Handler error: "+Y(t))}},t.prototype.handleDocumentRebootMessage=function(t){t.previousSessionId=this.To,this.raiseEvent(fi.DocumentReboot,t)},t.prototype.handleWopiInfoFromUrlRequest=function(t){this.raiseEvent(fi.WopiInfoFromUrl,t)},t.prototype.handleAuthTokenRequest=function(t){this.raiseEvent(fi.GetAuthToken,t)},t.prototype.handleCustomAuthConfigRequest=function(t){this.raiseEvent(fi.GetCustomAuthConfig,t)},t}();var wi=function(t){function i(i,e,n,o,r){var s=t.call(this,i,e,n,o,r)||this;return s.Oo=5e3,s.Vn=r.innerApplicationFrame,s.Bn=n,s.$t=e,s.mo={},s.ao=r.isCore,s.Ao=r.currentPage,s.lo=r.zoomLevel,s.do=r.pageCount,s.Uo=!s.ao,s.Bn.registerMessagePayloadHandler(wt.te,s.handleZoomChange.bind(s)),s.Bn.registerMessagePayloadHandler(wt.Wi,s.handlePageChange.bind(s)),s.Bn.registerMessagePayloadHandler(wt.yi,s.handleIsDisabled.bind(s)),s.Bn.registerMessagePayloadHandler(wt.wi,s.raiseError.bind(s)),s}return f(i,t),i.prototype.SetCurrentPage=function(t){var i=this;this.Uo?this.raiseError({errorType:Ft.ApiDisabledError,errorObject:{isCoreMode:this.ao}}):(this.Po=t,this.Vn&&this.Bn.sendPostMessage(this.Vn.contentWindow,gt._e,{newPage:this.Po}),window.setTimeout((function(){i.Po!==i.Ao&&i.$t.ULS.u(596444179,r.O,n.Info,'Did not receive the page change update. {"RequestedPage": '+i.Po+', "CurrentPage": '+i.Ao+"}")}),this.Oo))},i.prototype.GetPageCount=function(){return this.Uo&&this.raiseError({errorType:Ft.ApiDisabledError,errorObject:{isCoreMode:this.ao}}),this.do},i.prototype.GetCurrentPage=function(){return this.Uo&&this.raiseError({errorType:Ft.ApiDisabledError,errorObject:{isCoreMode:this.ao}}),this.Ao},i.prototype.SetZoomLevel=function(t){var i=this;this.Uo?this.raiseError({errorType:Ft.ApiDisabledError,errorObject:{isCoreMode:this.ao}}):(this.Eo=Number(t.toFixed(2)),this.Vn&&this.Bn.sendPostMessage(this.Vn.contentWindow,gt.Oe,{newLevel:this.Eo}),window.setTimeout((function(){i.Eo!==i.lo&&i.$t.ULS.u(596444180,r.O,n.Info,'Did not receive the zoom change update. {"RequestedZoom": '+i.Eo+', "CurrentZoom": '+i.lo+"}")}),this.Oo))},i.prototype.GetZoomLevel=function(){return this.Uo&&this.raiseError({errorType:Ft.ApiDisabledError,errorObject:{isCoreMode:this.ao}}),this.lo},i.prototype.GetIsDisabled=function(){return this.Uo},i.prototype.GetApplicationType=function(){return"Word Viewer"},i.prototype.RegisterEventHandler=function(t,i){switch(t){case fi.ZoomChanged:case fi.PageChanged:case fi.IsDisabled:if(this.mo[t])throw new Error("Duplicate registration");this.mo[t]=i;break;default:this.Bn.registerMessagePayloadHandler(t,i)}},i.prototype.RemoveEventHandler=function(t,i){switch(t){case fi.ZoomChanged:case fi.PageChanged:case fi.IsDisabled:if(this.mo[t]!==i)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.mo[t];break;default:this.Bn.removeMessageHandler(t)}},i.prototype.RegisterErrorHandler=function(t){this.Ro=t},i.prototype.RemoveErrorHandler=function(t){if(this.Ro!==t)throw new Error("The handler requested to be removed does not exist");delete this.Ro},i.prototype.raiseError=function(t){var i={errorType:"",errorObject:{}};if(i.errorType=t.errorType,i.errorObject=t.errorObject,!i.errorType||!i.errorObject)throw new TypeError("Error object is missing errorType or errorObject");this.Ro&&this.Ro(i)},i.prototype.handleZoomChange=function(t){this.lo=t.newLevel,this.raiseEvent(fi.ZoomChanged,t)},i.prototype.handlePageChange=function(t){this.Ao=t.newPage,this.raiseEvent(fi.PageChanged,t)},i.prototype.handleIsDisabled=function(t){this.Uo=t.isDisabled,this.raiseEvent(fi.IsDisabled,t)},i}(mi);function gi(t,i,e){if(!e||!e.isFeatureEnabled(ht.Vt))return[];var n={};try{n=JSON.parse( "{'wordeditor.js': {UrlHash: 'hE6CB09977A679542', SriHash: '5ssJl3pnlUJTEE0i1mxSnY5i4bAmFwikgtoUwz9TaSs='}, 'wordeditor.box4.dll1.js': {UrlHash: 'hD189C7ECFB72BF4B', SriHash: '0YnH7Ptyv0vsqTRX8XWuG9lrEqSBJJHTmjg0RHZ01yo='}, 'jsanity.js': {UrlHash: 'hCF8E38AF39F430EA', SriHash: 'z444rzn0MOq9zjznUneZA0alEnkHVi7j8wZAq6gul5g='}, 'compat.js': {UrlHash: 'h06FE78141D1F3A43', SriHash: 'Bv54FB0fOkNUQaF+yPn0avcACvNaoBM8aZxTfWY2B9A='}, 'microsoftajax.js': {UrlHash: 'hEC3E0FECD8521498', SriHash: '7D4P7NhSFJiso5KRIhlJfVDBDuIfzY5nDwS4a9fXsiU='}, 'wacboot.min.js': {UrlHash: 'hF1C20575CEB8F34A', SriHash: '8cIFdc6480ogPBztitKfBL5T4KLSYaXJVR8PSc5kD78='}}")}catch(t){}var o=T(t).replace("word-view","word-edit")+"/we/s/",r=""+o+Q()+"_",s=["App_Scripts/Compat.js","App_Scripts/WordEditor.js","App_Scripts/jSanity.js","App_Scripts/wacBoot.min.js","App_Scripts/MicrosoftAjax.js"].map((function(t){var i=t.substring(t.lastIndexOf("/")+1).toLowerCase();return n&&n[i]?o+n[i].UrlHash+"_"+t:r+t}));return s[4]=s[4].replace("word-edit","officeapps"),s}var Ii,Si=function(t,i,e,o,s){return new Promise((function(t){e.pendingReboot=!0;var o=void 0;if(i.queryOverrides)try{o=JSON.parse(i.queryOverrides)}catch(t){e.logger.ULS.u(592217694,r.F,n.Error,"Failed to parse queryOverrides: "+o)}e.raiseEvent(It.Reboot,d(d({},i),{previousSessionId:e.sessionId,queryOverrides:o})),t({completion:"success"})}))},bi=function(t,i,e){return new Promise((function(i){e.logger.ULS.u(590111070,r.F,n.Error,"Unsupported flow: "+t),i({completion:"failure"})}))},Ci=function(){function t(t){var i=this;this.Fo=!1,this.Wo=[],this.cancel=function(){i.Fo||(i.Fo=!0,i.Wo.map((function(t){return t()})),i.Wo=[])},window.setTimeout(this.cancel,t)}return Object.defineProperty(t.prototype,"isCancelled",{get:function(){return this.Fo},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){this.Fo?t():this.Wo.push(t)},t}();function yi(t){return new Ci(t)}var Ti=((Ii={})[wt.gi]={Me:It.FileEmbed,No:mt.sendEmbeddedViewUrl,xo:gt.be},Ii[wt._i]={Me:It.GetAccessToken,No:mt.sendAccessToken,xo:gt.we},Ii[wt.Oi]={Me:It.GetAuthToken,No:mt.sendAuthToken,xo:gt.ge},Ii[wt.Ai]={Me:It.GetCustomAuthConfig,No:mt.sendCustomAuthConfig,xo:gt.Ie},Ii[wt.Ui]={Me:It.GetWopiInfoFromUrl,No:mt.sendWopiInfo,xo:gt.Te},Ii[wt.Di]={Me:It.RefreshSessionInfo,No:mt.sendSessionInfo,xo:gt.Ce},Ii[wt.Xi]={Me:It.UserAccessAndPermissions,No:mt.sendUserAccessAndPermissions,xo:gt.ye},Ii),_i=function(t,i,e){var n=Ti[t];return n?new Promise((function(t){var o=function(t,i){e.container&&e.container.postMessage(n.xo,i),r({completion:"success"})},r=function(i){e.removeActionHandler(n.No,o),t(i)};e.addActionHandler(n.No,o),new Ci(5e3).subscribe((function(){r({completion:"cancelled"})})),e.raiseEvent(n.Me,i)})):bi(t,0,e)};function Oi(t,i,e,n){var o=Ti[t];return o?new Promise((function(t){var r=function(t,i){e.application&&e.application.PostCommand(o.No,i),s({completion:"success"})},s=function(e){i.removeActionHandler(o.No,r),t(e)};i.addActionHandler(o.No,r),new Ci(5e3).subscribe((function(){s({completion:"cancelled"})})),i.raiseEvent(o.Me,n)})):bi(t,0,i)}function Ai(t,i){if(void 0===t)throw new TypeError("SessionBootParams");var e=t.appUrl,n=t.appBaseUrl;if(void 0===e&&void 0===n)throw new TypeError("Either appUrl or appBaseUrl should exist");if(void 0!==e&&"string"!=typeof e)throw new TypeError("AppUrl");if(void 0!==n&&"string"!=typeof n)throw new TypeError("AppBaseUrl");var o=t.file;if(void 0===o||void 0===o.name)throw new TypeError("FileInfo");var r,s=t.container;if(void 0===s||!(s instanceof Wt)&&void 0===s.appendChild)throw new TypeError("Container");if(!i&&(!((r=t.wopi)&&r.source&&r.accessToken)||!r.expiry&&0!==r.expiry))throw new TypeError("WopiInfo")}function Ui(t,i,e,o,s,a){return t!==mt.boot?Promise.reject("Wrong flow"):new Promise((function(t){var c,u;Ai(o,i.skipWopiValidation),i.state=k.Booting,i.pendingReboot=!1,i.rebootOverride=o.rebootOverride,i.appBaseUrl=o.appBaseUrl?o.appBaseUrl.toLowerCase():T(o.appUrl).toLowerCase(),i.appUrl=o.appUrl||"",i.appBasePath=s.buildAppBasePath(i),i.intent=o.intent,i.file=o.file,i.wopi=o.wopi,i.contentBundle=o.contentBundle,i.ownerId=o.ownerId,i.sessionContext=o.sessionContext,i.actNavId=o.actNavId,i.wdParams=o.wdParams,i.preseededSession=o.preseededSession,i.throttling=o.throttling,i.hostInitDiagnostics=o.diagnostics,i.appInitDiagnostics={},o.rebootOverride&&(c=Tt(),i.sessionId=c[0],u=c[1],i.At.addSettingsChangeListener(i.logger.settingsChangeHandler)),i.logger.configure({remoteUlsEndpoint:O(i.appBasePath),sessionId:i.sessionId}),i.At.initializePeriodicFetch(i.appBasePath,i.sessionId),u&&i.logger.ULS.u(589842332,r.F,n.Info,JSON.stringify(u));var h=function(n,o){e.error=n,e.appInitDiagnostics=o,i.appInitDiagnostics=o;var r={completion:"failure",error:n};i.raiseEvent(It.BootCompleted,r),i.state=k.Failed,t(r)};a&&a.subscribe((function(){h({errorType:"Cancelled",errorObject:void 0})}));var f=function(t,i,e,n){var o=t.appBasePath+(Vt(t.appUrl)?"wordeditorframe.aspx":"wordviewerframe.aspx")+"?";if(t.appUrl){var r=E(t.appUrl);Object.keys(r).forEach((function(t){o+=t+"="+r[t]+"&"}))}var s=t.ui;s&&s.uiEmbed&&(o=P(o,"uiembed","1"));var a=t.host;a.uiHostName&&(o=P(o,"uih",a.uiHostName));var c=t.user;c.isLicensed&&(o=P(o,"islicenseduser","1"));i.actNavId&&(o=P(o,"actnavid",i.actNavId));var u=i.container,h=u instanceof Wt?u.element:u,f=i.bootParams,d=t.viewMode,l=a.capabilities,p=i.file,v=i.contentBundle,m=i.preseededSession,w=i.throttling,g=i.wopi,I=i.newFileTemplate;return{BootstrapperUrl:t.bootstrapperUrl,Container:h,SessionInformation:{HostName:t.hostName,HostSessionId:t.hostSessionId,UserId:c.id,OwnerId:i.ownerId,UiLocale:s&&s.language,DataLocale:f&&f.dataLanguage,DisableChat:f&&f.disableChat,CookieCompliant:f&&f.cookieCompliant,WdParams:i.wdParams,SessionContext:i.sessionContext,DisableFocusOnBoot:d&&d.disableFocusOnBoot,HighContrastMode:s?s.highContrast:void 0,HideViewerToolbar:d&&d.hideToolbar,SupportsAccessibilityLoop:l&&l.accessibilityLoop,SupportsAtMentions:l&&l.atMentions,SupportsDocReboot:l&&l.rebootDoc,SupportsCreateNewDocument:l&&l.createNewDoc,SupportsAuthToken:l&&l.authToken,SupportsCustomAuthConfig:l&&l.customAuthConfig,SupportsMoveToFolder:l&&l.moveToFolder,SupportsExcelExternalLinks:l&&l.excelExternalLinks,SupportsRefreshAccessToken:l&&l.refreshAccessToken,HideHeader:s&&s.hideHeader,HideBreadCrumbInViewer:d&&d.hideBreadCrumb,HideTitleInViewer:d&&d.hideTitle,HideWACOneDriveFileLocationPicker:s&&s.hideWacOneDriveFileLocationPicker,UiHostIntegrationType:a&&a.uiHostIntegrationType,MetaUiHostVersion:a&&a.metaUiHostVersion},ApplicationUrl:o,WopiPrecheckInfo:{FileName:p.name,FileGetUrl:p.getUrl,FileSize:p.size,BundleInfo:v?{MajorVersion:v.majorVersion,Url:v.url,BundleStaleness:v.staleness}:void 0,IsNewFile:f&&f.isNewFile,IsNewFileFromHostTemplate:f&&f.isFromHostTemplate,ReadOnly:f&&f.readOnly,IrmEnabled:f&&f.irmEnabled,ETag:p.eTag,PreseededSessionKey:m&&m.key,PreseededWacSessionId:m&&m.id,DocUniqueId:p.uniqueId,ClientThrottlingProtection:w&&w.protection,RequestedCallThrottling:w&&w.request},ApplicationCustomSettings:{HostUIControls:s&&s.controls},Diagnostics:i.diagnostics,WopiInfo:{WopiSrc:g.source,AccessToken:g.accessToken,AccessTokenExpiry:new Date(g.expiry)},FnOnInitializeSuccess:e,FnOnInitializeFailure:n,NewFileTemplateSource:I?{FileGetUrl:I.getUrl,FileSize:I.size,ETag:I.eTag,DocUniqueId:I.uniqueId}:void 0,RebootOverrideData:i.rebootOverride}}(i,o,(function(n,o){if(!a||!a.isCancelled){e.application=n,e.appInitDiagnostics=o,i.appInitDiagnostics=o,n.RegisterAllEventsHandler((function(t){i.onMessage(t)}));var r={completion:"success"};i.raiseEvent(It.BootCompleted,r),i.state=k.Booted,t(r)}}),h),d=e.bootstrapper.InitializeWopiPending(f,i.logger,i.sessionId,void 0,i.featureManager,i.At);d&&d.Complete(f.WopiInfo),e.pendingApplication=d}))}function Pi(t){var i=t.appBaseUrl.indexOf("word-edit")>-1,e=t.rebootOverride;if(e){var n=e.mode;n&&("view"===(n=n.toLowerCase())&&i?t.appBaseUrl=qt(t.appBaseUrl):"edit"!==n||i||(t.appBaseUrl=Gt(t.appBaseUrl)))}else{var o=t.ui&&t.ui.uiEmbed&&t.bootParams&&t.bootParams.readOnly;i&&!o||t.raiseEvent(It.ModeSwitched,{NewMode:"view"}),i&&o&&(t.appBaseUrl=qt(t.appBaseUrl))}return i=t.appBaseUrl.indexOf("word-edit")>-1,t.appBaseUrl+(i?"/we/":"/wv/")}function Ei(t){return t.appBasePath.indexOf("word-edit")>-1&&t.wopi&&t.bootParams&&t.bootParams.isNewFile}function Ri(t,i,e){var n=E(t.appUrl);A(n,"jsapi","1"),A(n,"jsapiver","v2"),A(n,"corrid",t.sessionId),A(n,"usid",t.sessionId),A(n,"newsession","1"),A(n,"sftc","1"),t.hostSessionId&&A(n,"hid",encodeURIComponent(t.hostSessionId));var o=t.host;o.uiHostName&&A(n,"uih",o.uiHostName),o.uiHostIntegrationType&&A(n,"uihit",encodeURIComponent(o.uiHostIntegrationType)),o.metaUiHostVersion&&A(n,"muv",encodeURIComponent(o.metaUiHostVersion));var r=o.capabilities;r&&(r.accessibilityLoop&&A(n,"accloop","1"),r.authToken&&A(n,"sat","1"),r.createNewDoc&&A(n,"scnd","1"),r.rebootDoc&&A(n,"sdr",r.rebootDoc.toString()),r.customAuthConfig&&A(n,"cac","1"),r.refreshAccessToken&&A(n,"rat","1"),r.atMentions&&A(n,"sams","1"),r.moveToFolder&&A(n,"mtf","1"));var s=t.ui;s&&(s.hideHeader&&A(n,"hhdr","1"),s.highContrast&&A(n,"hcm",encodeURIComponent(s.highContrast)),s.uiEmbed&&A(n,"uiembed","1"),s.language&&A(n,"ui",encodeURIComponent(s.language)),s.hideWacOneDriveFileLocationPicker&&A(n,"hodflp","1"));var a=t.wopi;a&&a.source&&A(n,"wopisrc",encodeURIComponent(a.source));var c=t.bootParams;c&&(c.readOnly&&A(n,"readonly","1"),c.dataLanguage&&A(n,"rs",encodeURIComponent(c.dataLanguage)),c.disableChat&&A(n,"dchat","1"),c.cookieCompliant&&A(n,"mscc","1"),c.isNewFile&&(A(n,"new","1"),c.isFromHostTemplate&&A(n,"wdtpl","fromhost"))),t.user.isLicensed&&A(n,"islicenseduser","1"),t.actNavId&&A(n,"actnavid",t.actNavId),t.sessionContext&&A(n,"sc",encodeURIComponent(t.sessionContext));var u=t.wdParams;if(u)for(var h in u)A(n,h,u[h]);var f=t.preseededSession;f&&(f.key&&A(n,"preseededsessionkey",encodeURIComponent(f.key)),f.id&&A(n,"preseededwacsessionid",encodeURIComponent(f.id)));var l=t.throttling;l&&(l.request&&A(n,"rct",l.request),l&&A(n,"ctp",l.protection));var p=t.hostInitDiagnostics;p&&(p.entryPoint&&A(n,"wdorigin",encodeURI(p.entryPoint)),p.userClickTime&&A(n,"wdhostclicktime",p.userClickTime.toString()));var v=t.appBasePath.indexOf("word-edit")>-1,m=t.viewMode;m&&(m.hideToolbar&&A(n,v?"hvt":"core","1"),m.hideBreadCrumb&&A(n,"hbcv","1"),m.hideTitle&&A(n,"htv","1"),m.disableFocusOnBoot&&A(n,"disablefocusonboot","1")),v&&(a?c&&c.isNewFile||(A(n,"instantedit","1"),A(n,"wopicomplete","1")):(A(n,"instantedit","1"),A(n,"filesrc",encodeURIComponent(t.hostName)),A(n,"pmorigin",encodeURIComponent(T(window.location.href)))),i===mt.createNew&&(delete n.newsession,A(n,"build",encodeURIComponent(Z())),A(n,"wacusertype","WOPI"),t.file.getUrl&&A(n,"filegeturlpresent","1"),e&&A(n,"wopisrc",encodeURIComponent(e.source)))),a&&A(n,"wdredirectionreason",function(t,i,e,n){return t?"Unified_SingleFlush":i?"Unified_IrmEnabled":e&&n?"Unified_UiEmbedReadOnly":"Unified_ViewActionUrl"}(v,c&&c.irmEnabled,s&&s.uiEmbed,c&&c.readOnly));var w=t.rebootOverride;if(w){var g=w.previousSessionId;g&&A(n,"wdprevioussession",g),n=d(d({},n),w.queryOverrides)}var I=v?i===mt.createNew?"wordeditorstartsession.ashx":"wordeditorframe.aspx":"wordviewerframe.aspx",S=t.appBasePath+I+"?",b=[];for(var h in n)n[h]&&b.push(h+"="+n[h]);return S+b.join("&")}function Fi(t){var i={},e=t.wopi;e&&(i[Ot.Xe]=e.accessToken,i[Ot.Ke]=e.expiry.toString());var n=t.contentBundle;n&&n.url&&n.url.length>0&&(i[Ot.Qe]=n.url);var o=t.file;o.getUrl&&(i[Ot.on]=o.getUrl);var r=o.name;if(r){i[Ot.rn]=r;var s=r.lastIndexOf(".");if(-1!==s){var a=r.substring(s+1);a&&(i[Ot.nn]=a)}}var c=t.newFileTemplate;c&&(i[Ot.gn]=c.getUrl),c&&c.size?i[Ot.sn]=c.size.toString():o.size&&(i[Ot.sn]=o.size.toString()),c&&c.eTag?i[Ot.in]=c.eTag:o.eTag&&(i[Ot.in]=o.eTag),c&&c.uniqueId?i[Ot.tn]=c.uniqueId:o.uniqueId&&(i[Ot.tn]=o.uniqueId),t.user.id&&(i[Ot.Sn]=t.user.id),t.ownerId&&(i[Ot.vn]=t.ownerId),t.sessionContext&&(i[Ot.mn]=t.sessionContext),i[Ot.en]=pt(t.featureManager,t.wdParams);var u=t.ui;return u&&u.controls&&(i[Ot.pn]=JSON.stringify(u.controls)),i[Ot.fn]=String(window.devicePixelRatio>1.24),i[Ot.wn]=String(g()),i[Ot.ln]=t.hostName,i}var Wi=function(){var t,i,e={bootstrapper:$i};return[(t={},t[vt.accessToken]=function(t,i,n,o){return Oi(t,n,e,i)},t[vt.appReboot]=Si,t[vt.authToken]=function(t,i,n,o){return Oi(t,n,e,i)},t[vt.boot]=function(t,i,n,o,r){return Ui(t,n,e,i,o,r)},t[vt.closeTab]=bi,t[vt.createNew]=bi,t[vt.customAuthConfig]=function(t,i,n,o){return Oi(t,n,e,i)},t[vt.dispose]=function(t,i,n,o,r){return function(t,i,e,n){return t!==mt.dispose?Promise.reject("Wrong flow"):new Promise((function(t){i.state=k.Disposing;var o=!!i.host.requireExplicitUnload,r=function(){var e={completion:"success"};i.raiseEvent(It.Disposed,e),i.state=k.Disposed,t(e)};if(n&&n.subscribe((function(){t({completion:"cancelled"})})),e.application){var s=e.application;o&&s.registerEventHandlerInternal(fi.Disposed,r),s.Dispose(o),o||r()}else e.pendingApplication?e.pendingApplication.Dispose(o,r):r()}))}(t,n,e,r)},t[vt.fileEmbed]=function(t,i,n,o){return Oi(t,n,e,i)},t[vt.frameTrust]=bi,t[vt.handleBootState]=bi,t[vt.postMessage]=function(t,i,n,o,r){return function(t,i,e,n,o){return e.application.PostCommand(t,n),Promise.resolve({completion:"success"})}(t,0,e,i)},t[vt.refreshSessionInfo]=function(t,i,n,o){return Oi(t,n,e,i)},t[vt.rename]=function(t,i,n,o,r){return function(t,i,e,n,o){return new Promise((function(r){var s=function(t,i){var e={completion:i.NewName===n.NewName?"success":"failure"};c(e)},a=function(t,i){c({completion:"failure"})},c=function(t){i.removeActionHandler(wt.Si,s),i.removeActionHandler(wt.bi,a),r(t)};i.addActionHandler(wt.Si,s),i.addActionHandler(wt.bi,a),(o||new Ci(5e3)).subscribe((function(){c({completion:"cancelled"})})),e.application&&e.application.PostCommand(t,n)}))}(t,n,e,i,r)},t[vt.setOverlayContent]=bi,t[vt.switchMode]=function(t,i,n,o,r){return function(t,i,e,n,o){return new Promise((function(r){var s=function(t,i){a({completion:"success"})},a=function(t){i.removeActionHandler(wt.Ei,s),r(t)};i.addActionHandler(wt.Ei,s),(o||new Ci(5e3)).subscribe((function(){a({completion:"cancelled"})})),e.application&&e.application.PostCommand(t,n)}))}(t,n,e,i,r)},t[vt.userAccessAndPermissions]=function(t,i,n,o){return Oi(t,n,e,i)},t[vt.wopiInfoFromUrl]=bi,t),(i={},i[vt.boot]={buildAppBasePath:Pi,buildAppUrl:function(){return""},buildPostData:function(){return{}},buildBootRequestParams:function(){return{appPageName:"",queryParamsOverrides:{},postDataOverrides:{}}}},i)]},Ni=[],xi=function(t,i,e,o,s){return new Promise((function(t){var a,c=j();Ai(i,e.skipWopiValidation),e.state=k.Booting,e.pendingReboot=!1,ot(e.logger,!0);var u,h=!1,f=function(t,i){var s,a;h||(e.container.postMessage(gt.se,void 0),s=e.appInitDiagnostics,(a=i.Diagnostics)&&Object.keys(a).forEach((function(t){s[t]=a[t]}))),o.onBootSuccess&&o.onBootSuccess(e),e.logger.ULS.u(596448985,r.F,n.Info,JSON.stringify(e.diagnostics)),e.logger.ULS.flush(),e.container.postMessage(gt.de,{HostInitializeDiagnostics:e.hostInitDiagnostics}),e.state=k.Booted;var c={completion:"success"};e.raiseEvent(It.BootCompleted,c),p(c),tt(e.appInfo.name,e.logger)},l=function(t,i){e.logger.ULS.u(596448986,r.F,n.Error,JSON.stringify({error:i.Error,diagnostics:e.diagnostics})),e.logger.ULS.flush(),e.state=k.Failed;var o={completion:"failure"};e.raiseEvent(It.BootCompleted,o),p(o),tt(e.appInfo.name,e.logger)},p=function(i){h||(ut(),dt(Ni),Ni=[],e.removeActionHandler(wt.si,f),e.removeActionHandler(wt.oi,l)),t(i)};if((s||new Ci(3e5)).subscribe((function(){p({completion:"cancelled"})})),e.rebootOverride=i.rebootOverride,e.appBaseUrl=i.appBaseUrl?i.appBaseUrl.toLowerCase():T(i.appUrl).toLowerCase(),e.appUrl=i.appUrl||"",e.appBasePath=o.buildAppBasePath(e),e.intent=i.intent,e.file=i.file,e.wopi=i.wopi,e.contentBundle=i.contentBundle,e.bootParams=i.bootParams||{},e.appUrl&&W(e.appUrl)&&(e.bootParams.isNewFile=!0),e.ownerId=i.ownerId,e.sessionContext=i.sessionContext,e.actNavId=i.actNavId,e.preseededSession=i.preseededSession,e.throttling=i.throttling,e.hostInitDiagnostics=d(d({},i.diagnostics),{hostInitializeCallTime:c}),e.wdParams=i.wdParams||{},window.location.search.substring(1).split("&").forEach((function(t){if(/^wd\w+=\w+/.test(t)){var i=t.split("=");e.wdParams[i[0]]=i[1]}})),i.rebootOverride&&(a=Tt(),e.sessionId=a[0],u=a[1],e.At.addSettingsChangeListener(e.logger.settingsChangeHandler)),e.logger.configure({remoteUlsEndpoint:O(e.appBasePath),sessionId:e.sessionId}),e.At.initializePeriodicFetch(e.appBasePath,e.sessionId),u&&e.logger.ULS.u(590966790,r.F,n.Info,JSON.stringify(u)),function(t){try{var i=t.hostInitDiagnostics;t.logger.ULS.u(590447446,r.F,n.Info,"HostInitDiagnostics: "+(i?JSON.stringify(i):"N/A")),t.logger.ULS.u(596444237,r.F,n.Info,JSON.stringify({session:it(t),client:et()}))}catch(i){t.logger.ULS.u(590447447,r.F,n.Error,"Failed to log init info: "+Y(i))}}(e),e.appInitDiagnostics={officeSessionId:e.sessionId,officeBootstrapperVersion:Z(),hostName:e.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(function(){e.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!e.container){var v=i.container;e.container=v instanceof Wt?v:e.application.createContainer(v)}e.container.setMessageHandler(e.onMessage),(h=!!o.ignoreCompletionMessage&&o.ignoreCompletionMessage(e))||(e.addActionHandler(wt.si,f),e.addActionHandler(wt.oi,l));var m=o.buildAppUrl(e);if(e.bootstrapperUrl&&e.preloader&&e.preloader.shouldPreload(m))try{o.beforePreload&&o.beforePreload(e);var w=e.bootstrapperUrl;e.featureManager.isFeatureEnabled(ht.Nt)&&(e.logger.ULS.u(590966791,r.F,n.Info,"HTTP2 preload enabled"),w=F(w));var g=void 0;e.ui&&(g=e.ui.language),g||(g=decodeURIComponent(U(m,"ui"))),e.preloader.preload(w,g,e.logger,e.featureManager)}catch(t){e.logger.ULS.u(590966792,r.F,n.Error,Y(t))}var I=o.buildPostData(e);o.beforeContainerBoot&&o.beforeContainerBoot(e,m),e.appInitDiagnostics.officeFrameCreateTime=j(),e.container.boot(m,I,e.logger),h?f(wt.si,{Diagnostics:{}}):(ct(b(e.appBaseUrl),e.At,e.logger,(function(){return ft(e.logger)})),Ni.push(window.setTimeout((function(){return ft(e.logger,1)}),e.At.getValue(L.gt,6e4))),Ni.push(window.setTimeout((function(){return ft(e.logger,2)}),e.At.getValue(L.It,18e4))))}))},Mi=function(t,i,e,o,s){return new Promise((function(t){var i=e.host.requireExplicitUnload,o={disposeStartTime:j(),forceAppUnload:i};e.state=k.Disposing;var a=function(){var i={completion:"success"};e.raiseEvent(It.Disposed,i),e.state=k.Disposed,t(i)},c=function(t){e.dispose(),o.disposeEndTime=j(),function(t,i,e){if(e){var o=Number(e.hostMessageReceived);i.appUnloadStartTime&&!isNaN(o)&&(i.hostToAppPostMessageLatency=o-i.appUnloadStartTime);var s=Number(e.appMessageSent);!isNaN(s)&&i.appUnloadEndTime&&(i.appToHostPostMessageLatency=i.appUnloadEndTime-s);var a=Number(e.appUnloadStart),c=Number(e.appUnloadEnd);if(isNaN(a)||isNaN(c)||(i.appUnloadLatency=c-a),e.serverTimings){var u=e.serverTimings;for(var h in u)i["st-"+h.toString()]=u[h]}}t.logger.ULS.u(592524822,r.F,n.Info,"App disposed: "+JSON.stringify(i)),t.logger.ULS.flushOnClose()}(e,o,t),rt(),e.container?e.container.dispose(e.pendingReboot,i).then(a):a()};if(i){o.appUnloadStartTime=j();e.addActionHandler(wt.Gi,(function(t,i){o.appUnloadEndTime=j(),c(i)})),(s||new Ci(5e3)).subscribe((function(){e.state===k.Disposing&&(o.appUnloadTimedOut=!0,c())})),e.container&&e.container.postMessage(gt.Re,void 0)}else c()}))};var ki,Di,Bi=function(t,i,e,o,s){return new Promise((function(t){var i=!!e.container&&e.container.isTopFrameTrusted;e.logger.ULS.u(592445957,r.F,n.Info,"Top frame is trusted: "+i),e.container&&e.container.postMessage(gt.Ti,{isTopFrameTrusted:i}),t({completion:"success"})}))},Hi=function(t,i,e,o,s){return new Promise((function(t){var s=i&&i.state?i.state:"Unknown";e.logger.ULS.u(592839750,r.F,n.Info,"Boot state: ["+s+"]"),o&&o.beforeComplete&&o.beforeComplete(s),t({completion:"success"})}))},ji=function(t,i,e,n,o){return new Promise((function(t){var n=function(t,e){var n={completion:e.NewName===i.NewName?"success":"failure"};s(n)},r=function(t,i){s({completion:"failure"})},s=function(i){e.removeActionHandler(wt.Si,n),e.removeActionHandler(wt.bi,r),t(i)};e.addActionHandler(wt.Si,n),e.addActionHandler(wt.bi,r),(o||new Ci(5e3)).subscribe((function(){s({completion:"cancelled"})})),e.container&&e.container.postMessage(gt.me,i)}))},Ji=function(t,i,e,n,o){return new Promise((function(t){var n=function(t,i){r({completion:"success"})},r=function(i){e.removeActionHandler(wt.Ei,n),t(i)};e.addActionHandler(wt.Ei,n),(o||new Ci(5e3)).subscribe((function(){r({completion:"cancelled"})})),e.container&&e.container.postMessage(gt.Ee,i)}))};function Li(t){if(!(t.appBaseUrl.indexOf("word-edit")>-1)){t.logger.ULS.u(588375430,r.O,n.Info,"Boot Word viewer");var i=window.navigator.userAgent;if(!(i.indexOf("Mobi")>=0&&i.indexOf("iPad")<0)){var e=t.rebootOverride;if(!e||!e.reason||"translate"!==e.reason.toLowerCase()){var o=t.viewMode;if(!o||!o.forceAccessibilityMode){var s=t.contentBundle;if(s&&s.url){t.logger.ULS.u(588378183,r.O,n.Info,"Kick off first page optimization");var a=t.container.element,c=a.ownerDocument;(ki=c.createElement("div")).id="FirstPageContainer",ki.style.top=o&&o.hideToolbar?"0":"90px",ki.style.left="0",ki.style.textAlign="center",ki.style.width="1px",ki.style.bottom="0",ki.style.zIndex="900",ki.style.height="1px",ki.style.position="absolute",ki.style.padding="0 29px",ki.style.right="0",ki.style.overflow="auto",ki.style.marginLeft="auto",ki.style.marginRight="auto",ki.style.maxWidth="100%",a.appendChild(ki);var u=c.createElement("img");u.id="FirstPageImage",u.style.marginTop="11px",u.style.marginBottom="11px",u.style.maxWidth="100%",u.style.border="solid 1px #d2d5d8",u.draggable=!1,u.onload=function(){t.logger.ULS.u(588378184,r.O,n.Info,"First page optimization loaded"),ki.style.width="",ki.style.height="",Di=j()},u.onerror=function(i){zi(),t.logger.ULS.u(588378185,r.O,n.Warning,"Cannot load first page from cache"),t.appInitDiagnostics.errorObject={errorType:"CannotLoadFirstPage",errorObject:i.returnValue}},u.src=s.url.replace("{0}","p1.img"),ki.appendChild(u)}}}}}}function Vi(t){if(zi(),Di){t.container.postMessage(gt.fe,{HostCacheLoadTime:Di});var i=t.appInitDiagnostics;i.documentLoadedTime?Di<i.documentLoadedTime?(i.documentLoadedTime=Di,i.documentLoadedFromWopiPrecheckInfo=!0,t.logger.ULS.u(588378186,r.O,n.Info,"First page loaded from cache was faster")):i.documentLoadedFromWopiPrecheckInfo=!1:i.documentLoadedTime=Di}}function zi(){ki&&ki.parentElement&&ki.parentElement.removeChild(ki)}function qi(){return!0}var Gi,Zi=function(t){return t.isFeatureEnabled(ht.Lt)||t.isFeatureEnabled(ht.Ht)?[(i={},i[vt.accessToken]=_i,i[vt.appReboot]=Si,i[vt.authToken]=_i,i[vt.boot]=xi,i[vt.closeTab]=bi,i[vt.createNew]=bi,i[vt.customAuthConfig]=_i,i[vt.dispose]=Mi,i[vt.fileEmbed]=_i,i[vt.frameTrust]=Bi,i[vt.handleBootState]=Hi,i[vt.postMessage]=bi,i[vt.refreshSessionInfo]=_i,i[vt.rename]=ji,i[vt.setOverlayContent]=Lt,i[vt.switchMode]=Ji,i[vt.userAccessAndPermissions]=_i,i[vt.wopiInfoFromUrl]=bi,i),(e={},e[vt.boot]={buildAppBasePath:Pi,ignoreCompletionMessage:Ei,buildAppUrl:Ri,buildPostData:Fi,buildBootRequestParams:function(){return{appPageName:"",queryParamsOverrides:{},postDataOverrides:{}}},beforeContainerBoot:Li,onBootSuccess:Vi},e[vt.createNew]={parallelizeStartSessionRequest:qi,buildStartSessionUrl:Ri},e)]:Wi();var i,e};!function(t){t[t.NotSupported=0]="NotSupported",t[t.SameDocOnly=1]="SameDocOnly",t[t.AnyDoc=2]="AnyDoc",t[t.OtherMode=4]="OtherMode"}(Gi||(Gi={})),e.d(i,"Application",(function(){return $i})),e.d(i,"Viewer",(function(){return Xi})),e.d(i,"createApplication",(function(){return Ki})),e.d(i,"ApplicationEvents",(function(){return fi})),e.d(i,"DocRebootSupportMode",(function(){return Gi})),e.d(i,"CommandIds",(function(){return mt})),e.d(i,"EventIds",(function(){return It})),e.d(i,"createCancellationToken",(function(){return yi}));var $i=new di((function(t,i,e,n,o){return new mi(t,i,e,n,o)}),{forceSingleStepBoot:!1,preloader:N(Vt,gi)}),Xi=new di((function(t,i,e,n,o){return new wi(t,i,e,n,o)}),{forceSingleStepBoot:!0,useViewerInitializer:!0}),Ki=function(t){var i={name:"Word",preloader:N(Vt,gi)};return new Nt(t,i,Zi)}}});

